<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Qu·∫£n l√Ω ch∆∞∆°ng tr√¨nh h·ªçc</title>

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">

    <!-- Custom styles for this page -->
    <link href="vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
    <script src="js/common.js"></script>
	<script src="https://www.w3schools.com/lib/w3.js"></script>
    <style>
        .mon-hoc-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .mon-hoc-item:last-child {
            margin-bottom: 0;
        }
        .remove-mon-hoc {
            color: #e74a3b;
            cursor: pointer;
        }
        .mon-hoc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .nav-tabs .nav-link.active {
            font-weight: bold;
            color: #4e73df;
        }
        .tab-content {
            padding: 20px 0;
        }
        .khoa-group {
            margin-bottom: 30px;
            border: 1px solid #e3e6f0;
            border-radius: 5px;
            overflow: hidden;
        }
        .khoa-header {
            background-color: #4e73df;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
        }
        .chuyen-nganh-card {
            border-left: 4px solid #4e73df;
            margin-bottom: 10px;
        }
        .chuyen-nganh-header {
            background-color: #f8f9fc;
            padding: 10px 15px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chuyen-nganh-body {
            padding: 15px;
            background-color: white;
        }
        .badge-khoa {
            font-size: 1rem;
            background-color: #2e59d9;
        }
        .loai-hoc-phan {
            margin-bottom: 15px;
            border-bottom: 1px dashed #e3e6f0;
            padding-bottom: 10px;
        }
        .loai-hoc-phan-title {
            font-weight: bold;
            color: #2e59d9;
            margin-bottom: 10px;
        }
		#detailModal .modal-lg {
		    max-width: 90%;
		    width: 95%;
		}
        .mon-hoc-table {
            width: 100%;
			font-size: 14px;
        }
		.mon-hoc-table th {
		    white-space: nowrap;
		    background-color: #f8f9fc;
		    padding: 10px 12px;
		}

		.mon-hoc-table td {
		    padding: 8px 12px;
		    vertical-align: top;
		}
		/* Cho ph√©p ng·∫Øt d√≤ng cho c√°c √¥ d√†i */
		.mon-hoc-table td.wrap-text {
		    white-space: normal;
		    word-break: break-word;
		    max-width: 200px;
		}
		/* Ti√™u ƒë·ªÅ lo·∫°i h·ªçc ph·∫ßn n·ªïi b·∫≠t */
		.loai-hoc-phan-title {
		    font-weight: bold;
		    color: #2e59d9;
		    margin: 15px 0 10px 0;
		    font-size: 16px;
		    border-bottom: 1px solid #eee;
		    padding-bottom: 5px;
		}
		/* Modal body scroll n·∫øu n·ªôi dung d√†i */
		.modal-body {
		    max-height: 70vh;
		    overflow-y: auto;
		}
		@media (max-width: 992px) {
		    .mon-hoc-table {
		        display: block;
		        overflow-x: auto;
		    }
		    
		    #detailModal .modal-lg {
		        max-width: 100%;
		        width: 100%;
		        margin: 10px;
		    }
		    
		    .mon-hoc-table th, 
		    .mon-hoc-table td {
		        min-width: 120px;
		    }
		}
		.search-container {
		    padding: 0.5rem 1rem;
		}

		#searchMonHocInput {
		    min-width: 250px;
		}

		.search-result-item {
			border: 1px solid #e3e6f0;
		    border-radius: 5px;
		    margin-bottom: 20px;
		    background-color: #fff;
		}

		.search-result-header {
			padding: 15px;
			border-bottom: 1px solid #e3e6f0;
			background-color: #f8f9fc !important;
		}
		.search-result-header h5 {
		    color: #2e59d9;
		    font-weight: bold;
		    margin-bottom: 5px;
		}

		.search-monhoc-table {
		    width: 100%;
		    font-size: 14px;
		}

		.search-monhoc-table th {
		    background-color: #f8f9fc;
		    padding: 8px 12px;
		}
		/* Th√™m v√†o ph·∫ßn style */
		.search-result-item {
		    border-left: 4px solid #4e73df;
		    margin-bottom: 20px;
		    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
		}

		
		.badge-khoa {
		    background-color: #2e59d9;
		    color: white;
		    padding: 5px 10px;
		    border-radius: 15px;
		    font-size: 0.8rem;
		}

		.chuyen-nganh-card {
		    transition: all 0.3s;
		    border: 1px solid #e3e6f0;
		}

		.chuyen-nganh-card:hover {
		    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
		}

		.chuyen-nganh-header {
		    cursor: pointer;
		    padding: 10px 15px;
		    background-color: #f8f9fc;
		    display: flex;
		    justify-content: space-between;
		    align-items: center;
		}

		.chuyen-nganh-body {
		    padding: 15px;
		    background-color: white;
		}
		.mon-hoc-table {
		    margin-bottom: 0;
		}

		.mon-hoc-table th {
		    background-color: #f8f9fc;
		    white-space: nowrap;
		}

		.mon-hoc-table td {
		    vertical-align: middle;
		}

		.table-responsive {
		    border: none;
		}
		/* Th√™m v√†o ph·∫ßn style */
		.hoc-phan-card {
		    transition: all 0.3s;
		    height: 100%;
		}

		.hoc-phan-card:hover {
		    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
		    transform: translateY(-2px);
		}

		.selected-hoc-phan-item {
		    display: inline-flex;
		    align-items: center;
		    border: 1px solid #d1d3e2;
		}

		#hocPhanSearchResults {
		    min-height: 300px;
			color: #4F4F4F !important;
		}

		#selectedHocPhanContainer {
		    min-height: 60px;
		    border: 1px dashed #d1d3e2;
		    padding: 10px;
		    border-radius: 5px;
		}

		#hocPhanTable {
		    font-size: 14px;
		}

		#hocPhanTable th {
		    white-space: nowrap;
		}
		#step3 {
		    display: block !important; /* Ghi ƒë√® n·∫øu c·∫ßn */
		}
		/* CSS cho b·∫£ng lo·∫°i h·ªçc ph·∫ßn */
		#loaiHocPhanTable th {
		    background-color: #f8f9fc;
		    white-space: nowrap;
		}

		#loaiHocPhanTable td {
		    vertical-align: middle;
		}

		.so-tin-chi {
		    max-width: 100px;
		}

		/* CSS cho modal th√™m h·ªçc ph·∫ßn */
		#addHocPhanModal .modal-body {
		    max-height: 70vh;
		    overflow-y: auto;
		}

		#hocPhanSearchResults {
		    min-height: 300px;
		}

		.selected-hoc-phan-item {
		    display: inline-flex;
		    align-items: center;
		    border: 1px solid #d1d3e2;
		    padding: 5px 10px;
		    margin: 2px;
		    border-radius: 4px;
		    background-color: #f8f9fa;
		}
		.table td, .table th {
		    vertical-align: middle !important;
			color: #4F4F4F !important;
		}

		.table td {
		    font-size: 14px;
		}
		.loai-hoc-phan h5 {
		    font-weight: bold;
		    border-bottom: 2px solid #007bff;
		    padding-bottom: 5px;
		}

		.loai-hoc-phan {
		    background-color: #f8f9fa;
		}

		.table th {
			vertical-align: middle !important;
		    background-color: #C6E2FF !important;
		    color: #444444;
		}

		.thead-dark th {
		    font-size: 0.875rem;
		    text-transform: uppercase;
		}
		.modal-title, .modal-body {
			color: #4F4F4F !important;
		}
		.form-group, .form-control {
			color: #5a5c69 !important;
			font-weight: bold;
		}
		
		
		.khoa-header {
		        transition: background-color 0.3s ease;
	    }
	    .khoa-header:hover {
	        background-color: #4876FF;
	    }
		.rotate-icon {
		    transition: transform 0.3s ease;
		}
		.fa-chevron-up.rotate-icon {
		    transform: rotate(180deg);
		}
		/* Th√™m v√†o file CSS c·ªßa b·∫°n */
		.form-control-sm {
		    height: calc(1.5em + 0.5rem + 2px);
		    padding: 0.25rem 0.5rem;
		    font-size: 0.875rem;
		    line-height: 1.5;
		}

		.btn-sm {
		    padding: 0.25rem 0.5rem;
		    font-size: 0.875rem;
		    line-height: 1.5;
		}

		.btn-sm i {
		    margin-right: 3px;
		}

		.mr-1 {
		    margin-right: 0.25rem !important;
		}

		/* Highlight row in edit mode */
		tr.hoc-phan-goc.editing {
		    background-color: #fff3cd !important;
		}
		
		/* Th√™m v√†o file CSS c·ªßa b·∫°n */
		.card-header {
		    padding: 0.75rem 1.25rem;
		}

		.input-group {
		    width: auto;
		}

		#themHocPhanContainer {
		    border-bottom: 1px solid #e3e6f0;
		    padding-bottom: 1rem;
		    margin-bottom: 1rem;
		}

		#themHocPhanTable input {
		    min-width: 100px;
		}

		.btn-sm {
		    padding: 0.25rem 0.5rem;
		    font-size: 0.875rem;
		}

		.table-responsive {
		    margin-bottom: 0;
		}
		/* ƒê·∫£m b·∫£o th√¥ng b√°o kh√¥ng b·ªã tr√†n */
		.alert-info {
		    margin: 0 15px 15px 15px;
		    padding: 10px 15px;
		    display: flex;
		    align-items: center;
		    justify-content: space-between;
		}

		/* Responsive cho mobile */
		@media (max-width: 768px) {
		    .alert-info {
		        flex-direction: column;
		        align-items: flex-start;
		    }
		    .alert-info button {
		        margin-top: 8px;
		        margin-left: 0 !important;
		    }
		}
    </style>
</head>

<body id="page-top">
	
	
	<div id="loadingIndicator" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; text-align: center; padding-top: 20%;">
	    <div class="spinner-border text-light" role="status">
	        <span class="sr-only">Loading...</span>
	    </div>
	    <p class="text-light mt-2">ƒêang x·ª≠ l√Ω...</p>
	</div>
	
	
    <!-- Page Wrapper -->
    <div id="wrapper">
        <!-- Sidebar -->
       <div w3-include-html="_menu.html"></div>

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">
            <!-- Main Content -->
            <div id="content">
                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
                    <!-- Topbar Navbar -->
					<ul class="navbar-nav ml-auto">
					    <!-- Nav Item - User Information -->
					    <li class="nav-item dropdown no-arrow">
					        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					            <span class="mr-2 d-none d-lg-inline text-gray-600 small" id="userID">TK m·∫∑c ƒë·ªãnh</span>
					            <img class="img-profile rounded-circle" src="img/undraw_profile.svg">
					        </a>
					        <!-- Dropdown - User Information -->
					        <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="userDropdown">
					            <a class="dropdown-item" href="#">
					                <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
					                Profile
					            </a>
					            <a class="dropdown-item" href="#">
					                <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
					                Settings
					            </a>
					            <a class="dropdown-item" href="#">
					                <i class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>
					                Activity Log
					            </a>
					            <div class="dropdown-divider"></div>
					            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
					                <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
					                Logout
					            </a>
					        </div>
					    </li>
					</ul>

                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">
                    <!-- Page Heading -->
                    <h1 class="h3 mb-4 text-gray-800">Qu·∫£n l√Ω ch∆∞∆°ng tr√¨nh h·ªçc</h1>

                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="view-tab" data-toggle="tab" href="#view" role="tab" aria-controls="view" aria-selected="true">Danh s√°ch ch∆∞∆°ng tr√¨nh h·ªçc</a>
                        </li>
                        <li class="nav-item" id="tab-them-chuong-trinh">
                            <a class="nav-link" id="add-tab" data-toggle="tab" href="#add" role="tab" aria-controls="add" aria-selected="false">Th√™m ch∆∞∆°ng tr√¨nh h·ªçc</a>
                        </li>
						<li class="nav-item">
						    <a class="nav-link" id="hocphan-tab" data-toggle="tab" href="#hocphan" role="tab" aria-controls="hocphan" aria-selected="false">Danh s√°ch h·ªçc ph·∫ßn</a>
						</li>
						<li class="nav-item">
						  <a class="nav-link" id="kiemtra-tab" data-toggle="tab" href="#kiemtra" role="tab" aria-controls="kiemtra" aria-selected="false">
						    Ki·ªÉm tra h·ªçc ph·∫ßn
						  </a>
						</li>
						<li class="nav-item flex-grow-1 ml-3">
						  <div class="nav-link p-0 h-100 border-0 bg-transparent">
						    <div class="input-group">
						      <input type="text" class="form-control" id="searchMonHocInput" placeholder="T√¨m ch∆∞∆°ng tr√¨nh h·ªçc theo m√£ / t√™n HP">
						      <div class="input-group-append">
						        <button class="btn btn-primary" id="btnSearchMonHoc">
						          <i class="fas fa-search"></i>
						        </button>
						      </div>
						    </div>
						  </div>
						</li>

						
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content" id="myTabContent">
                        <!-- Tab Xem danh s√°ch -->
                        <div class="tab-pane fade show active" id="view" role="tabpanel" aria-labelledby="view-tab">
                            <div class="card shadow mb-4 mt-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Danh s√°ch ch∆∞∆°ng tr√¨nh h·ªçc theo chuy√™n ng√†nh v√† kh√≥a</h6>
                                </div>
                                <div class="card-body">
									<div id="loadingChuongTrinhHoc" class="text-center py-3" style="display: none;">
									    <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
									    <div>ƒêang t·∫£i d·ªØ li·ªáu ch∆∞∆°ng tr√¨nh h·ªçc...</div>
									</div>
                                    <div id="chuongTrinhHocContainer">
                                        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c load b·∫±ng JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
					
						<!-- Th√™m tab n·ªôi dung Danh s√°ch h·ªçc ph·∫ßn -->
						<div class="tab-pane fade" id="hocphan" role="tabpanel" aria-labelledby="hocphan-tab">
						    <div class="card shadow mb-4 mt-4">
						        <div class="card-header py-3 d-flex justify-content-between align-items-center">
						            <h6 class="m-0 font-weight-bold text-primary">Danh s√°ch t·∫•t c·∫£ h·ªçc ph·∫ßn</h6>
						            <div>
						                <div class="input-group">
						                    <input type="text" id="searchInput" class="form-control" placeholder="T√¨m ki·∫øm HP theo m√£ / t√™n" style="width: 250px;">
						                    <div class="input-group-append">
						                        <button class="btn btn-primary" onclick="timKiemHocPhan(document.getElementById('searchInput').value)">
						                            <i class="fas fa-search"></i>
						                        </button>
						                    </div>
											
						                </div>
						            </div>
									
									<!-- Th√™m id cho n√∫t ƒë·ªÉ c√≥ th·ªÉ ƒëi·ªÅu khi·ªÉn b·∫±ng JS -->
						            <button id="btnThemHocPhan" class="btn btn-success ml-2" onclick="toggleThemHocPhan()" style="display: none;">
						                <i class="fas fa-plus"></i> Th√™m h·ªçc ph·∫ßn m·ªõi
						            </button>
						        </div>
								<!-- Th√™m v√†o sau ph·∫ßn search input -->
								<div id="searchInfoContainer" style="display: none;">
								    <div class="alert alert-info mb-3">
								        <span id="searchInfoText"></span>
								        <button class="btn btn-sm btn-outline-secondary" onclick="resetSearch()">
								            Quay l·∫°i danh s√°ch t·∫•t c·∫£ h·ªçc ph·∫ßn
								        </button>
								    </div>
								</div>

						        <div class="card-body">
						            <!-- Ph·∫ßn th√™m h·ªçc ph·∫ßn m·ªõi (·∫©n ban ƒë·∫ßu) -->
						            <div id="themHocPhanContainer" style="display: none;">
						                <div class="table-responsive mb-4">
						                    <table class="table table-bordered" id="themHocPhanTable">
						                        <thead>
						                            <tr class="text-center">
						                                <th>M√£ HP</th>
														<th>M√£ HP hi·ªán t·∫°i</th>
						                                <th>T√™n h·ªçc ph·∫ßn</th>
						                                <th>S·ªë t√≠n ch·ªâ</th>
						                                <th>ƒêK Ti√™n quy·∫øt</th>
														<th>S·ªë ca</th>
														<th>GV ph·ª• tr√°ch</th>
						                                <th>M√£ GV</th>														
						                                <th>Ng√†nh ph·ª• tr√°ch</th>
						                                <th>Thao t√°c</th>
						                            </tr>
						                        </thead>
						                        <tbody id="themHocPhanTableBody">
						                            <!-- D√≤ng m·∫´u ƒë·ªÉ th√™m h·ªçc ph·∫ßn m·ªõi -->
						                            <tr>
						                                <td><input type="text" class="form-control form-control-sm" placeholder="M√£ HP"></td>
														<td><input type="text" class="form-control form-control-sm" placeholder="M√£ HP hi·ªán t·∫°i"></td>
						                                <td><input type="text" class="form-control form-control-sm" placeholder="T√™n h·ªçc ph·∫ßn"></td>
						                                <td><input type="number" class="form-control form-control-sm" placeholder="S·ªë t√≠n ch·ªâ"></td>
						                                <td><input type="text" class="form-control form-control-sm" placeholder="ƒêK ti√™n quy·∫øt"></td>
														<td><input type="number" class="form-control form-control-sm" placeholder="S·ªë ca"></td>
						                                <td><input type="text" class="form-control form-control-sm" placeholder="T√™n GV"></td>
														<td><input type="text" class="form-control form-control-sm" placeholder="M√£ GV"></td>
						                                <td><input type="text" class="form-control form-control-sm" placeholder="Ng√†nh ph·ª• tr√°ch"></td>
						                                <td class="text-center">
						                                    <button class="btn btn-danger btn-sm" onclick="xoaDongThemHocPhan(this)">
						                                        <i class="fas fa-trash-alt"></i>
						                                    </button>
						                                </td>
						                            </tr>
						                        </tbody>
						                    </table>
						                </div>
						                <div class="text-right mb-3">
						                    <button class="btn btn-secondary mr-2" onclick="themDongHocPhanMoi()">
						                        <i class="fas fa-plus-circle"></i> Th√™m d√≤ng
						                    </button>
						                    <button class="btn btn-primary" onclick="luuHocPhanMoi()">
						                        <i class="fas fa-save"></i> L∆∞u t·∫•t c·∫£
						                    </button>
						                </div>
						            </div>

						            <!-- Danh s√°ch h·ªçc ph·∫ßn hi·ªán c√≥ -->
						            <div class="table-responsive">
						                <table class="table table-bordered" id="hocPhanTable" width="100%" cellspacing="0">
						                    <thead>
						                        <tr class="text-center">
						                            <th>M√£ HP</th>
						                            <th>T√™n h·ªçc ph·∫ßn</th>
						                            <th>S·ªë t√≠n ch·ªâ</th>
						                            <th>ƒêK Ti√™n quy·∫øt</th>
													<th>S·ªë ca</th>
						                            <th>GV ph·ª• tr√°ch</th>
						                            <th>Ng√†nh ph·ª• tr√°ch</th>
						                            <th>HP thay th·∫ø</th>
						                            <th id="hocPhanThaoTacTh">Thao t√°c</th>
						                        </tr>
						                    </thead>
						                    <tbody id="hocPhanTableBody">
						                        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c load b·∫±ng JavaScript -->
						                    </tbody>
						                </table>
						                <div id="loadingDsHp" class="text-center py-3" style="display: none;">
						                    <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
						                    <div>ƒêang t·∫£i danh s√°ch h·ªçc ph·∫ßn...</div>
						                </div>
						            </div>
									
									<!-- modal th√™m hp thay th·∫ø -->
									<div class="modal fade" id="themHocPhanThayTheModal" tabindex="-1" role="dialog" aria-labelledby="themHocPhanThayTheModalLabel" aria-hidden="true">
									    <div class="modal-dialog" role="document">
									        <div class="modal-content">
									            <div class="modal-header">
									                <h5 class="modal-title text-primary" id="themHocPhanThayTheModalLabel">Th√™m h·ªçc ph·∫ßn thay th·∫ø</h5>
									                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
									                    <span aria-hidden="true">&times;</span>
									                </button>
									            </div>
									            <div class="modal-body">
													<form id="formThemHocPhanThayThe">
													    <input type="hidden" id="maHocPhanGoc">
													    
													    <div class="form-group">
													        <label for="khoaApDungTu">√Åp d·ª•ng t·ª´ kh√≥a</label>
													        <input type="number" class="form-control" id="khoaApDungTu">
													    </div>
													    <div class="form-group">
													        <label for="khoaApDungDen">√Åp d·ª•ng ƒë·∫øn kh√≥a</label>
													        <input type="number" class="form-control" id="khoaApDungDen">
													    </div>

													    <label>Danh s√°ch m√£ h·ªçc ph·∫ßn thay th·∫ø *</label>
													    <div id="danhSachThayTheContainer"></div>
													    <button type="button" class="btn btn-sm btn-secondary my-2" onclick="themDongHocPhanThayThe()">+ Th√™m h·ªçc ph·∫ßn</button>
													</form>

									            </div>
									            <div class="modal-footer">
									                <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
									                <button type="button" class="btn btn-primary" onclick="themHocPhanThayThe()">L∆∞u</button>
									            </div>
									        </div>
									    </div>
									</div>
						        </div>
						    </div>
						</div>
						
                        <!-- Tab Th√™m m·ªõi -->
						<div class="tab-pane fade" id="add" role="tabpanel" aria-labelledby="add-tab">
						    <div class="card shadow mb-4">
						        <div class="card-header py-3">
						            <h6 class="m-0 font-weight-bold text-primary">Th√™m ch∆∞∆°ng tr√¨nh h·ªçc m·ªõi</h6>
						        </div>
						        <div class="card-body">
						            <!-- B∆∞·ªõc 1: T·∫°o ch∆∞∆°ng tr√¨nh h·ªçc c∆° b·∫£n -->
						            <div id="step1">
						                <form id="createChuongTrinhForm">
						                    <div class="form-group row">
						                        <label class="col-sm-2 col-form-label">Chuy√™n ng√†nh</label>
						                        <div class="col-sm-10">
						                            <select class="form-control" id="chuyenNganh" required>
						                                <option value="">-- Ch·ªçn chuy√™n ng√†nh --</option>
														<option value="CONG_NGHE_THONG_TIN">C√¥ng ngh·ªá th√¥ng tin</option>
														<option value="KHOA_HOC_MAY_TINH">Khoa h·ªçc m√°y t√≠nh</option>
														<option value="TRI_TUE_NHAN_TAO">Tr√≠ tu·ªá nh√¢n t·∫°o</option>
														<option value="HE_THONG_THONG_TIN">H·ªá th·ªëng th√¥ng tin</option>
														<option value="MANG_MAY_TINH">M·∫°ng m√°y t√≠nh v√† truy·ªÅn th√¥ng d·ªØ li·ªáu</option>
														<option value="KE_TOAN">K·∫ø to√°n</option>
														<option value="TAI_CHINH_NGAN_HANG">T√†i ch√≠nh - Ng√¢n h√†ng</option>
														<option value="LOGISTIC">Logistics</option>
														<option value="QUAN_TRI_KINH_DOANH">Qu·∫£n tr·ªã kinh doanh</option>
														<option value="QUAN_TRI_KHACH_SAN">Qu·∫£n tr·ªã kh√°ch s·∫°n</option>
														<option value="MARKETING">Marketing</option>
														<option value="KINH_TE_QUOC_TE">Kinh t·∫ø qu·ªëc t·∫ø</option>
														<option value="LUAT_KINH_TE">Lu·∫≠t kinh t·∫ø</option>
														<option value="THUONG_MAI_DIEN_TU">Th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠</option>
														<option value="DICH_VU_DU_LICH_LU_HANH">D·ªãch v·ª• du l·ªãch - l·ªØ h√†nh</option>
														<option value="NGON_NGU_ANH">Ng√¥n ng·ªØ Anh</option>
														<option value="NGON_NGU_TRUNG">Ng√¥n ng·ªØ Trung</option>
														<option value="NGON_NGU_NHAT">Ng√¥n ng·ªØ Nh·∫≠t</option>
														<option value="NGON_NGU_HAN">Ng√¥n ng·ªØ H√†n</option>
														<option value="VIET_NAM_HOC">Vi·ªát Nam h·ªçc</option>
														<option value="CONG_TAC_XA_HOI">C√¥ng t√°c x√£ h·ªôi</option>
														<option value="TRUYEN_THONG_DA_PHUONG_TIEN">Truy·ªÅn th√¥ng ƒëa ph∆∞∆°ng ti·ªán</option>
														<option value="THIET_KE_DO_HOA">Thi·∫øt k·∫ø ƒë·ªì h·ªça</option>
														<option value="DIEU_DUONG">ƒêi·ªÅu d∆∞·ª°ng</option>
														<option value="DINH_DUONG">Dinh d∆∞·ª°ng</option>
														<option value="THANH_NHAC">Thanh nh·∫°c</option>
						                            </select>
						                        </div>
						                    </div>

						                    <div class="form-group row">
						                        <label class="col-sm-2 col-form-label" >Kh√≥a h·ªçc</label>
						                        <div class="col-sm-10">
						                            <select class="form-control" id="khoa" required>
						                                <option value="">-- Ch·ªçn kh√≥a h·ªçc --</option>
														<option value="K30">K30</option>
														<option value="K31">K31</option>
														<option value="K32">K32</option>
														<option value="K33">K33</option>
														<option value="K34">K34</option>
														<option value="K35">K35</option>
														<option value="K36">K36</option>
														<option value="K37">K37</option>
														<option value="K38">K38</option>
														<option value="K39">K39</option>
														<option value="K40">K40</option>
														<option value="K41">K41</option>
													</select>
						                        </div>
						                    </div>

						                    <div class="form-group text-right">
						                        <button type="submit" class="btn btn-primary">
						                            <i class="fas fa-plus"></i> T·∫°o ch∆∞∆°ng tr√¨nh h·ªçc
						                        </button>
						                    </div>
						                </form>
						            </div>
						            
						            <!-- B∆∞·ªõc 2: Qu·∫£n l√Ω lo·∫°i h·ªçc ph·∫ßn -->
						            <div id="step2" style="display: none;">
						                <div class="alert alert-success">
						                    ƒê√£ t·∫°o ch∆∞∆°ng tr√¨nh h·ªçc th√†nh c√¥ng! <strong id="createdChuongTrinhInfo"></strong>
						                </div>

						                <div class="card shadow mb-4">
						                    <div class="card-header py-3">
						                        <h6 class="m-0 font-weight-bold text-primary">Qu·∫£n l√Ω lo·∫°i h·ªçc ph·∫ßn</h6>
						                    </div>
						                    <div class="card-body">
						                        <div class="table-responsive">
						                            <table class="table table-bordered" id="loaiHocPhanTable" width="100%" cellspacing="0">
						                                <thead>
						                                    <tr>
						                                        <th>Lo·∫°i h·ªçc ph·∫ßn</th>
						                                        <th>S·ªë t√≠n ch·ªâ t·ªëi thi·ªÉu</th>
																<th>Ghi ch√∫ (n·∫øu c√≥)</th>
						                                        <th>Thao t√°c</th>
						                                    </tr>
						                                </thead>
						                                <tbody id="loaiHocPhanList">
						                                    <!-- Danh s√°ch 6 lo·∫°i h·ªçc ph·∫ßn m·∫∑c ƒë·ªãnh s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
															
						                                </tbody>
						                            </table>
						                        </div>
						                    </div>
											<div id="loadingLoaiHocPhan" class="text-center py-3" style="display: none;">
											  <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
											  <div>ƒêang t·∫£i lo·∫°i h·ªçc ph·∫ßn...</div>
											</div>

						                </div>
						            </div>
						            
						            <!-- B∆∞·ªõc 3: Th√™m h·ªçc ph·∫ßn v√†o lo·∫°i h·ªçc ph·∫ßn (Modal) -->
						            <div class="modal fade" id="addHocPhanModal" tabindex="-1" role="dialog" aria-hidden="true">
						                <div class="modal-dialog modal-lg" role="document">
						                    <div class="modal-content">
						                        <div class="modal-header">
						                            <h5 class="modal-title">Th√™m h·ªçc ph·∫ßn v√†o: <span id="modalLoaiHocPhanTitle"></span></h5>
						                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
						                                <span aria-hidden="true">&times;</span>
						                            </button>
						                        </div>
						                        <div class="modal-body">
						                            <div class="row mb-3">
						                                <div class="col-md-6">
						                                    <div class="input-group">
						                                        <input type="text" class="form-control" id="searchHocPhanInput" 
						                                               placeholder="T√¨m h·ªçc ph·∫ßn...">
						                                        <div class="input-group-append">
						                                            <button class="btn btn-outline-secondary" type="button" id="btnSearchHocPhan">
						                                                <i class="fas fa-search"></i>
						                                            </button>
						                                        </div>
						                                    </div>
						                                </div>
						                            </div>
						                            
						                            <div id="selectedHocPhanContainer" class="mb-3">
						                                <h6>H·ªçc ph·∫ßn ƒë√£ ch·ªçn:</h6>
						                                <div id="selectedHocPhanList" class="d-flex flex-wrap">
						                                    <!-- C√°c h·ªçc ph·∫ßn ƒë∆∞·ª£c ch·ªçn s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
						                                </div>
						                            </div>
						                            
						                            <div id="hocPhanSearchResults" class="row">
						                                <!-- K·∫øt qu·∫£ t√¨m ki·∫øm h·ªçc ph·∫ßn s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
						                            </div>
						                        </div>
						                        <div class="modal-footer">
						                            <button type="button" class="btn btn-secondary" data-dismiss="modal">ƒê√≥ng</button>
						                            <button type="button" class="btn btn-primary" id="btnSaveHocPhan">L∆∞u h·ªçc ph·∫ßn</button>
						                        </div>
						                    </div>
						                </div>
						            </div>
									
									<!-- Modal: T·∫°o t·ªï h·ª£p h·ªçc ph·∫ßn -->
									<div class="modal fade" id="createToHopModal" tabindex="-1" role="dialog" aria-hidden="true">
									  <div class="modal-dialog" role="document">
									    <form id="createToHopForm">
									      <div class="modal-content">
									        <div class="modal-header">
									          <h5 class="modal-title">T·∫°o t·ªï h·ª£p h·ªçc ph·∫ßn cho <span id="modalLoaiTitle"></span></h5>
									          <button type="button" class="close" data-dismiss="modal">&times;</button>
									        </div>
									        <div class="modal-body">
									          <input type="hidden" id="ctxLoaiId">
									          <div class="form-group">
									            <label>T√™n t·ªï h·ª£p</label>
									            <input type="text" id="toHopTen" class="form-control" required>
									          </div>
									          <div class="form-group">
									            <label>S·ªë t√≠n ch·ªâ t·ªëi thi·ªÉu</label>
									            <input type="number" id="toHopTinChi" class="form-control">
									          </div>
									          <div class="form-group">
									            <label>S·ªë l∆∞·ª£ng m√¥n t·ªëi thi·ªÉu</label>
									            <input type="number" id="toHopSoLuong" class="form-control">
									          </div>
									          <div class="form-check">
									            <input type="checkbox" id="toHopBatBuoc" class="form-check-input">
									            <label class="form-check-label" for="toHopBatBuoc">B·∫Øt bu·ªôc h·ªçc t·∫•t c·∫£</label>
									          </div>
									        </div>
									        <div class="modal-footer">
									          <button class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
									          <button type="submit" class="btn btn-primary">T·∫°o t·ªï h·ª£p</button>
									        </div>
									      </div>
									    </form>
									  </div>
									</div>

									<!-- Modal: T·∫°o nh√≥m m√¥n trong t·ªï h·ª£p -->
									<div class="modal fade" id="createNhomModal" tabindex="-1" role="dialog" aria-hidden="true">
									  <div class="modal-dialog" role="document">
									    <form id="createNhomForm">
									      <div class="modal-content">
									        <div class="modal-header">
									          <h5 class="modal-title">T·∫°o nh√≥m m√¥n cho t·ªï h·ª£p <span id="modalToHopTitle"></span></h5>
									          <button type="button" class="close" data-dismiss="modal">&times;</button>
									        </div>
									        <div class="modal-body">
									          <input type="hidden" id="ctxToHopId">
									          <div class="form-group">
									            <label>T√™n nh√≥m m√¥n</label>
									            <input type="text" id="nhomTen" class="form-control" required>
									          </div>
									        </div>
									        <div class="modal-footer">
									          <button class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
									          <button type="submit" class="btn btn-primary">T·∫°o nh√≥m</button>
									        </div>
									      </div>
									    </form>
									  </div>
									</div>

						        </div>
						    </div>
						</div>
						<!-- Ki·ªÉm tra h·ªçc ph·∫ßn sinh vi√™n -->						
						<div class="tab-pane fade" id="kiemtra" role="tabpanel" aria-labelledby="kiemtra-tab">
						  <div class="card shadow mb-4 p-4">

						    <!-- üî• Ti√™u ƒë·ªÅ + √î nh·∫≠p n·∫±m c√πng 1 d√≤ng -->
						    <div class="d-flex justify-content-between align-items-center mb-3">
						      <h5 class="text-dark m-0">üîç Ki·ªÉm tra h·ªçc ph·∫ßn c√≤n thi·∫øu c·ªßa sinh vi√™n</h5>

						      <div class="form-inline">
						        <input type="text" id="maSinhVienInput" class="form-control mr-2" placeholder="Nh·∫≠p m√£ sinh vi√™n...">
						        <button class="btn btn-primary" id="btnCheckHocPhan">Ki·ªÉm tra</button>
						      </div>
						    </div>

						    <!-- üéØ Header t√™n sinh vi√™n -->
						    <div id="kiemtra-header" class="mb-4"></div>

						    <!-- Loading -->
						    <div id="loadingKiemTra" class="text-center py-3" style="display: none;">
						      <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
						      <div>ƒêang ki·ªÉm tra h·ªçc ph·∫ßn...</div>
						    </div>

						    <!-- K·∫øt qu·∫£ -->
						    <div id="ketQuaHocPhanConThieu" class="mb-5"></div>						    
						  </div>
						</div>


                    </div>
                </div>
                <!-- /.container-fluid -->
            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; Tr∆∞·ªùng ƒê·∫°i h·ªçc ThƒÉng Long 2023</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->
        </div>
        <!-- End of Content Wrapper -->
    </div>
    <!-- End of Page Wrapper -->

    <!-- Modal Xem chi ti·∫øt ch∆∞∆°ng tr√¨nh h·ªçc -->
	<div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="detailModalLabel" aria-hidden="true">
	    <div class="modal-dialog modal-lg" role="document">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title " id="detailModalLabel">Chi ti·∫øt ch∆∞∆°ng tr√¨nh h·ªçc</h5>
	                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                    <span aria-hidden="true">&times;</span>
	                </button>
	            </div>
	            <div class="modal-body">
	                <div class="row mb-3">
	                    <div class="col-md-6">
	                        <strong>Chuy√™n ng√†nh:</strong> 
	                        <span id="detailChuyenNganh"></span>
	                        <input type="hidden" id="detailChuyenNganhEnum">
	                    </div>
	                    <div class="col-md-6">
	                        <strong>Kh√≥a:</strong> 
	                        <span id="detailKhoa"></span>
	                        <input type="hidden" id="detailChuongTrinhId">
	                    </div>
	                </div>
	                
	                <div id="chiTietChuongTrinhBody">
	                    <!-- C√°c lo·∫°i h·ªçc ph·∫ßn v√† m√¥n h·ªçc s·∫Ω ƒë∆∞·ª£c load v√†o ƒë√¢y -->
	                </div>
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-secondary" data-dismiss="modal">ƒê√≥ng</button>
	            </div>
	        </div>
	    </div>
	</div>
	
	
	
	<!-- Th√™m modal hi·ªÉn th·ªã k·∫øt qu·∫£ -->
	<div class="modal fade" id="searchResultModal" tabindex="-1" role="dialog" aria-hidden="true">
	    <div class="modal-dialog modal-xl" role="document">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title">K·∫øt qu·∫£ t√¨m ki·∫øm m√¥n h·ªçc</h5>
	                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                    <span aria-hidden="true">&times;</span>
	                </button>
	            </div>
	            <div class="modal-body">
	                <div id="searchResultsContainer"></div>
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-secondary" data-dismiss="modal">ƒê√≥ng</button>
	            </div>
	        </div>
	    </div>
	</div>
    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

    <script>
		
		// ƒê·∫£m b·∫£o c√°c h√†m quan tr·ªçng t·ªìn t·∫°i
		window.renderDanhSachChuongTrinhHoc = window.renderDanhSachChuongTrinhHoc || function(data) {
		    console.log("Fallback render function called");
		    $('#chuongTrinhHocContainer').html(JSON.stringify(data, null, 2));
		};

		window.convertChuyenNganh = window.convertChuyenNganh || function(value) {
		    return value; // Fallback ƒë∆°n gi·∫£n
		};

		window.convertLoaiHocPhan = window.convertLoaiHocPhan || function(value) {
		    return value; // Fallback ƒë∆°n gi·∫£n
		};
		
		// Enum t∆∞∆°ng ·ª©ng v·ªõi Java
        const ChuyenNganh = {
            CONG_NGHE_THONG_TIN: 'CONG_NGHE_THONG_TIN',
            KHOA_HOC_MAY_TINH: 'KHOA_HOC_MAY_TINH',
            TRI_TUE_NHAN_TAO: 'TRI_TUE_NHAN_TAO',
            HE_THONG_THONG_TIN: 'HE_THONG_THONG_TIN',
            MANG_MAY_TINH: 'MANG_MAY_TINH',
            KE_TOAN: 'KE_TOAN',
            TAI_CHINH_NGAN_HANG: 'TAI_CHINH_NGAN_HANG',
            LOGISTIC: 'LOGISTIC',
            QUAN_TRI_KINH_DOANH: 'QUAN_TRI_KINH_DOANH',
            QUAN_TRI_KHACH_SAN: 'QUAN_TRI_KHACH_SAN',
            MARKETING: 'MARKETING',
            KINH_TE_QUOC_TE: 'KINH_TE_QUOC_TE',
            LUAT_KINH_TE: 'LUAT_KINH_TE',
            THUONG_MAI_DIEN_TU: 'THUONG_MAI_DIEN_TU',
            DICH_VU_DU_LICH_LU_HANH: 'DICH_VU_DU_LICH_LU_HANH',
            NGON_NGU_ANH: 'NGON_NGU_ANH',
            NGON_NGU_TRUNG: 'NGON_NGU_TRUNG',
            NGON_NGU_NHAT: 'NGON_NGU_NHAT',
            NGON_NGU_HAN: 'NGON_NGU_HAN',
            VIET_NAM_HOC: 'VIET_NAM_HOC',
            CONG_TAC_XA_HOI: 'CONG_TAC_XA_HOI',
            TRUYEN_THONG_DA_PHUONG_TIEN: 'TRUYEN_THONG_DA_PHUONG_TIEN',
            THIET_KE_DO_HOA: 'THIET_KE_DO_HOA',
            DIEU_DUONG: 'DIEU_DUONG',
            DINH_DUONG: 'DINH_DUONG',
            THANH_NHAC: 'THANH_NHAC'
        };

        const KhoaHoc = {
            K30: 'K30',
            K31: 'K31',
            K32: 'K32',
            K33: 'K33',
            K34: 'K34',
            K35: 'K35',
            K36: 'K36',
            K37: 'K37',
            K38: 'K38',
            K39: 'K39',
            K40: 'K40',
            K41: 'K41'
        };

        const LoaiHocPhan = {
            HOC_PHAN_DAI_CUONG: 'HOC_PHAN_DAI_CUONG',
            HOC_PHAN_CO_SO_NGANH: 'HOC_PHAN_CO_SO_NGANH',
            HOC_PHAN_BAT_BUOC_NGANH: 'HOC_PHAN_BAT_BUOC_NGANH',
            HOC_PHAN_LUA_CHON_NGANH: 'HOC_PHAN_LUA_CHON_NGANH',
            HOC_PHAN_TU_DO: 'HOC_PHAN_TU_DO',
            KLTN_CDTN_THUC_TAP: 'KLTN_CƒêTN_THUC_TAP'
        };

        // ===== C√ÅC H√ÄM CHUY·ªÇN ƒê·ªîI HI·ªÇN TH·ªä =====
        function convertChuyenNganh(enumValue) {
            const mapping = {
                'CONG_NGHE_THONG_TIN': 'C√¥ng ngh·ªá th√¥ng tin',
                'KHOA_HOC_MAY_TINH': 'Khoa h·ªçc m√°y t√≠nh',
                'TRI_TUE_NHAN_TAO': 'Tr√≠ tu·ªá nh√¢n t·∫°o',
                'HE_THONG_THONG_TIN': 'H·ªá th·ªëng th√¥ng tin',
                'MANG_MAY_TINH': 'M·∫°ng m√°y t√≠nh v√† truy·ªÅn th√¥ng d·ªØ li·ªáu',
                'KE_TOAN': 'K·∫ø to√°n',
                'TAI_CHINH_NGAN_HANG': 'T√†i ch√≠nh - Ng√¢n h√†ng',
                'LOGISTIC': 'Logistics',
                'QUAN_TRI_KINH_DOANH': 'Qu·∫£n tr·ªã kinh doanh',
                'QUAN_TRI_KHACH_SAN': 'Qu·∫£n tr·ªã kh√°ch s·∫°n',
                'MARKETING': 'Marketing',
                'KINH_TE_QUOC_TE': 'Kinh t·∫ø qu·ªëc t·∫ø',
                'LUAT_KINH_TE': 'Lu·∫≠t kinh t·∫ø',
                'THUONG_MAI_DIEN_TU': 'Th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠',
                'DICH_VU_DU_LICH_LU_HANH': 'D·ªãch v·ª• du l·ªãch - l·ªØ h√†nh',
                'NGON_NGU_ANH': 'Ng√¥n ng·ªØ Anh',
                'NGON_NGU_TRUNG': 'Ng√¥n ng·ªØ Trung',
                'NGON_NGU_NHAT': 'Ng√¥n ng·ªØ Nh·∫≠t',
                'NGON_NGU_HAN': 'Ng√¥n ng·ªØ H√†n',
                'VIET_NAM_HOC': 'Vi·ªát Nam h·ªçc',
                'CONG_TAC_XA_HOI': 'C√¥ng t√°c x√£ h·ªôi',
                'TRUYEN_THONG_DA_PHUONG_TIEN': 'Truy·ªÅn th√¥ng ƒëa ph∆∞∆°ng ti·ªán',
                'THIET_KE_DO_HOA': 'Thi·∫øt k·∫ø ƒë·ªì h·ªça',
                'DIEU_DUONG': 'ƒêi·ªÅu d∆∞·ª°ng',
                'DINH_DUONG': 'Dinh d∆∞·ª°ng',
                'THANH_NHAC': 'Thanh nh·∫°c'
            };
            return mapping[enumValue] || enumValue;
        }
        
        function convertLoaiHocPhan(enumValue) {
            const mapping = {
                'HOC_PHAN_DAI_CUONG': 'H·ªçc ph·∫ßn ƒë·∫°i c∆∞∆°ng',
                'HOC_PHAN_CO_SO_NGANH': 'H·ªçc ph·∫ßn c∆° s·ªü ng√†nh',
                'HOC_PHAN_BAT_BUOC_NGANH': 'H·ªçc ph·∫ßn b·∫Øt bu·ªôc ng√†nh',
                'HOC_PHAN_LUA_CHON_NGANH': 'H·ªçc ph·∫ßn l·ª±a ch·ªçn ng√†nh',
                'HOC_PHAN_TU_DO': 'H·ªçc ph·∫ßn t·ª± do',
                'KLTN_CDTN_THUC_TAP': 'KLTN - CƒêTN - Th·ª±c t·∫≠p'
            };
            return mapping[enumValue] || enumValue;
        }
		// ===== KHAI B√ÅO BI·∫æN V√Ä ENUM =====
		       
		// Th√™m c√°c bi·∫øn to√†n c·ª•c
		let danhSachChuongTrinhHoc = [];
		let currentChuongTrinhId = null;
		let currentLoaiHocPhanId = null;
		let danhSachHocPhan = [];
		let selectedHocPhanIds = [];
		let danhSachLoaiHocPhanDaThem = [];
		let danhSachHocPhanGlobal = []; // L∆∞u tr·ªØ danh s√°ch h·ªçc ph·∫ßn to√†n c·ª•c
		let currentContext = {}; // L∆∞u tr·ªØ ng·ªØ c·∫£nh hi·ªán t·∫°i (loai/tohop/nhom)
		let currentSearchKeyword = ''; // Th√™m bi·∫øn l∆∞u t·ª´ kh√≥a t√¨m ki·∫øm hi·ªán t·∫°i
		let danhSachDangHienThi = []; // Danh s√°ch hi·ªán ƒëang ƒë∆∞·ª£c hi·ªÉn th·ªã (k·∫øt qu·∫£ t√¨m ki·∫øm ho·∫∑c to√†n b·ªô)
		let isSearching = false;

	
		//h√†m ti·ªán √≠ch ph√¢n quy·ªÅn FE		
		function isAdminRole() {
		    return window.currentUserRole === 'quanTri' || window.currentUserRole === 'thuKy';
		}

		function isStudentOrTeacher() {
		    return window.currentUserRole === 'sinhVien' || window.currentUserRole === 'giangVien';
		}


        // ===== C√ÅC H√ÄM X·ª¨ L√ù CH∆Ø∆†NG TR√åNH H·ªåC =====
        $(document).ready(function() {
            // Load menu
            includeHTML();
            
			const isDevelopment = false; // Ho·∫∑c true n·∫øu ƒëang dev

			if (!isDevelopment) {
			    let tk = JSON.parse(localStorage.getItem('taiKhoan'));
			    if (!tk || !tk.ten) {
			        window.location.href = '/login.html';
			        return;
			    }
			    $('#userID').html(tk.ten + ' | ' + tk.userName);

			    window.currentUserRole = tk.dsQuyen;  // l·∫•y t·ª´ dsQuyen
			    console.log('‚úÖ currentUserRole =', window.currentUserRole);
			} else {
			    $('#userID').html('Ch·∫ø ƒë·ªô ph√°t tri·ªÉn - Kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p');
			    window.currentUserRole = 'quanTri'; // gi·∫£ l·∫≠p quy·ªÅn khi develop
			}
			
			const currentUser = JSON.parse(localStorage.getItem('taiKhoan'));
			    const currentUserRole = currentUser ? currentUser.dsQuyen : null;

			    console.log('‚úÖ Role ng∆∞·ªùi d√πng hi·ªán t·∫°i:', currentUserRole);

			    if (currentUserRole !== 'quanTri' && currentUserRole !== 'thuKy') {
			        console.warn('‚ö†Ô∏è Ng∆∞·ªùi d√πng kh√¥ng ph·∫£i admin, ·∫©n tab Th√™m ch∆∞∆°ng tr√¨nh h·ªçc');
			        $('#tab-them-chuong-trinh').hide();  // ·∫®n tab "Th√™m ch∆∞∆°ng tr√¨nh h·ªçc"
			    }
				if (currentUserRole === 'sinhVien') {
				    $('#maSinhVienInput').hide();      // ·∫®n √¥ nh·∫≠p m√£
				    $('#btnCheckHocPhan').hide();       // ·∫®n n√∫t "Ki·ªÉm tra"

				    // ‚úÖ T·ª± ƒë·ªông ki·ªÉm tra h·ªçc ph·∫ßn c·ªßa ch√≠nh m√¨nh
				    const currentUser = JSON.parse(localStorage.getItem('taiKhoan'));
				    const maSinhVien = currentUser?.userName;
				    if (maSinhVien) {
				        autoKiemTraHocPhan(maSinhVien);
				    }
				}

            // Load danh s√°ch ch∆∞∆°ng tr√¨nh h·ªçc khi trang ƒë∆∞·ª£c t·∫£i
            loadDanhSachChuongTrinhHoc();
            
            // Th√™m m√¥n h·ªçc m·ªõi
            $('#btnThemMonHoc').click(function() {
                themMonHoc();
            });
            
            // X·ª≠ l√Ω submit form
            $('#chuongTrinhHocForm').submit(function(e) {
                e.preventDefault();
                luuChuongTrinhHoc();
            });

            // X·ª≠ l√Ω s·ª± ki·ªán t√¨m ki·∫øm
            $('#btnSearchMonHoc').click(searchMonHoc);
            $('#searchMonHocInput').keypress(function(e) {
                if (e.which === 13) searchMonHoc();
            });
			
			// Load danh s√°ch h·ªçc ph·∫ßn khi v√†o tab
		    $('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
				console.log('üü¢ Tab ƒë∆∞·ª£c m·ªü:', e.target.id);
		        if (e.target.id === 'hocphan-tab') {
		            loadDanhSachHocPhan();
		        }
		    });
		    
		    // S·ª± ki·ªán t√¨m ki·∫øm h·ªçc ph·∫ßn
		    $('#btnSearchHocPhan').click(function() {
		        const keyword = $('#searchHocPhanInput').val();
		        searchHocPhan(keyword);
		    });
		    
		    $('#searchHocPhanInput').keyup(function() {
		        const keyword = $(this).val();
		        searchHocPhan(keyword);
		    });
		    
		    // Load danh s√°ch h·ªçc ph·∫ßn khi v√†o tab th√™m m·ªõi
		    $('#add-tab').on('shown.bs.tab', function() {
		        if (danhSachHocPhan.length === 0) {
		            loadDanhSachHocPhan();
		        } else {
		            renderHocPhanSearchResults(filterHocPhanSearchResults());
		        }
		    });
		    
		    // S·ª± ki·ªán click n√∫t "L∆∞u t√≠n ch·ªâ"
			$(document).on('click', '.btn-save-tinchi', function() {
			    const loaiId = $(this).data('loai-id');
			    saveSoTinChi(loaiId);
			});
			
			// G·∫Øn s·ª± ki·ªán click v√†o n√∫t x√≥a h·ªçc ph·∫ßn kh·ªèi ch∆∞∆°ng tr√¨nh h·ªçc
			$(document).on('click', '.btn-delete-hocphan', function () {
			    const hocPhanId = $(this).data('hpid');
			    const type = $(this).data('type'); // 'loai', 'tohop', 'nhom'
			    const ctId = $(this).data('ctid'); // n·∫øu type = loai
			    const toHopId = $(this).data('tohopid'); // n·∫øu type = tohop
			    const nhomId = $(this).data('nhomid'); // n·∫øu type = nhom

			    if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªçc ph·∫ßn n√†y kh√¥ng?')) {
			        return;
			    }

			    let url = '';
			    if (type === 'loai') {
			        const chuongTrinhId = $('#detailChuongTrinhId').val();
			        url = `/api/v1/chuongtrinhhoc/${chuongTrinhId}/hocphan/${hocPhanId}`;
			    } else if (type === 'tohop') {
			        url = `/api/v1/chuongtrinhhoc/tohop/${toHopId}/hocphan/${hocPhanId}`;
			    } else if (type === 'nhom') {
			        url = `/api/v1/chuongtrinhhoc/tohopnhommon/${nhomId}/hocphan/${hocPhanId}`;
			    } else {
			        alert('‚ùå Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c lo·∫°i x√≥a.');
			        return;
			    }

			    // G·ªçi API x√≥a
			    $.ajax({
			        url: url,
			        type: 'DELETE',
			        success: function () {
			            alert('‚úÖ ƒê√£ x√≥a h·ªçc ph·∫ßn th√†nh c√¥ng.');
			            // X√≥a d√≤ng h·ªçc ph·∫ßn kh·ªèi b·∫£ng ngay l·∫≠p t·ª©c
			            $(`button[data-hpid="${hocPhanId}"]`).closest('tr').remove();
			        },
			        error: function (xhr) {
			            alert('‚ùå L·ªói khi x√≥a: ' + (xhr.responseJSON?.message || xhr.statusText));
			        }
			    });
			});
			
			// G·∫Øn s·ª± ki·ªán click v√†o n√∫t x√≥a t·ªï h·ª£p h·ªçc ph·∫ßn
			$(document).on('click', '.btn-delete-tohop', function () {
			    const toHopId = $(this).data('tohopid');

			    if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·ªï h·ª£p h·ªçc ph·∫ßn n√†y kh√¥ng?')) {
			        return;
			    }

			    $.ajax({
			        url: `/api/v1/chuongtrinhhoc/tohop/${toHopId}`,
			        type: 'DELETE',
			        success: function () {
			            alert('‚úÖ ƒê√£ x√≥a t·ªï h·ª£p h·ªçc ph·∫ßn th√†nh c√¥ng.');
			            // X√≥a kh·ªèi giao di·ªán
			            $(`button[data-tohopid="${toHopId}"]`).closest('.tohop-container').remove();
			        },
			        error: function (xhr) {
			            alert('‚ùå L·ªói khi x√≥a t·ªï h·ª£p: ' + (xhr.responseJSON?.message || xhr.statusText));
			        }
			    });
			});

			// G·∫Øn s·ª± ki·ªán click v√†o n√∫t x√≥a t·ªï h·ª£p nh√≥m m√¥n
			$(document).on('click', '.btn-delete-nhom', function () {
			    const nhomId = $(this).data('nhomid');

			    if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√≥m m√¥n n√†y kh√¥ng?')) {
			        return;
			    }

			    $.ajax({
			        url: `/api/v1/chuongtrinhhoc/tohopnhommon/${nhomId}`,
			        type: 'DELETE',
			        success: function () {
			            alert('‚úÖ ƒê√£ x√≥a nh√≥m m√¥n th√†nh c√¥ng.');
			            // X√≥a kh·ªèi giao di·ªán
			            $(`button[data-nhomid="${nhomId}"]`).closest('.nhom-container').remove();
			        },
			        error: function (xhr) {
			            alert('‚ùå L·ªói khi x√≥a nh√≥m m√¥n: ' + (xhr.responseJSON?.message || xhr.statusText));
			        }
			    });
			});
			if (isAdminRole()) {
			    $('#btnThemHocPhan').show(); // d√πng jQuery ƒë·ªÉ nh·∫•t qu√°n
			    $('#hocphan-tab').text('Qu·∫£n l√Ω h·ªçc ph·∫ßn');
			}

        });
		
        
		const khoaGroup = $(`
		    <div class="khoa-group mb-3">
		        <div class="khoa-header px-3 py-2 rounded d-flex justify-content-between align-items-center" 
		             style="background-color: #6495ED; color: #D7D7D7; cursor: pointer;"
		             data-toggle="collapse"
		             data-target="#khoa-body-${khoa}"
		             aria-expanded="false"
		             aria-controls="khoa-body-${khoa}">
		            <strong>Kh√≥a: ${khoa}</strong>
		            <i class="fas fa-chevron-down"></i>
		        </div>
		        <div id="khoa-body-${khoa}" class="collapse mt-2"></div>
		    </div>
		`);

		// H√†m load danh s√°ch h·ªçc ph·∫ßn
		function loadDanhSachHocPhan() {
			$('#loadingDsHp').show();
		    return new Promise((resolve, reject) => {
		        $.ajax({
		            url: '/api/v1/hocphan-with-thaythe',
		            type: 'GET',
		            success: function(response) {
		                if (!response) {
		                    console.error('D·ªØ li·ªáu tr·∫£ v·ªÅ r·ªóng');
		                    reject('D·ªØ li·ªáu r·ªóng');
		                    return;
		                }
						$('#loadingDsHp').hide();
		                console.log('‚úÖ D·ªØ li·ªáu h·ªçc ph·∫ßn nh·∫≠n ƒë∆∞·ª£c:', response);
		                danhSachHocPhan = response;
						danhSachHocPhanGlobal = [...response]; // L∆∞u v√†o bi·∫øn to√†n c·ª•c
						// ‚õî N·∫øu ƒëang t√¨m ki·∫øm th√¨ kh√¥ng render danh s√°ch ƒë·∫ßy ƒë·ªß
						                if (!isSearching) {
						                    renderDanhSachHocPhan(response);
						                }
		                resolve(response);
		            },
		            error: function(xhr, status, error) {
		                console.error('‚ùå L·ªói khi t·∫£i danh s√°ch h·ªçc ph·∫ßn:', error, xhr.responseText);
		                alert('C√≥ l·ªói khi t·∫£i danh s√°ch h·ªçc ph·∫ßn: ' + error);
		                reject(error);
		            }
		        });
		    });
		}
		
		function renderDanhSachHocPhan(data, editingId = null) {
			danhSachDangHienThi = [...data];
		    const container = document.getElementById('hocPhanTableBody');
		    if (!container) {
		        console.warn('‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ #hocPhanTableBody trong DOM.');
		        return;
		    }

		    container.innerHTML = '';
			const searchInfoContainer = document.getElementById('searchInfoContainer');
			const searchInfoText = document.getElementById('searchInfoText');

			if (currentSearchKeyword && searchInfoContainer && searchInfoText) {
			    searchInfoText.innerText = `ƒêang hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm cho: "${currentSearchKeyword}"`;
			    searchInfoContainer.style.display = 'block';
			} else if (searchInfoContainer) {
			    searchInfoContainer.style.display = 'none';
			}

		    const currentUser = JSON.parse(localStorage.getItem('taiKhoan'));
		    const currentUserRole = currentUser ? currentUser.dsQuyen : null;
		    const isAdmin = currentUserRole === 'quanTri' || currentUserRole === 'thuKy';

		    // ·∫®n/hi·ªán c·ªôt Thao t√°c
		    const thaoTacTh = document.getElementById('hocPhanThaoTacTh');
		    if (thaoTacTh) {
		        thaoTacTh.style.display = isAdmin ? '' : 'none';
		    }

		    data.forEach(hp => {
		        const isEditing = hp.id === editingId;
		        const row = document.createElement('tr');
		        row.className = 'hoc-phan-goc';
		        row.id = `hocphan-row-${hp.id}`;
		        
		        const accordionId = `thaythe-${hp.maHocPhan.replace(/\s+/g, '-')}`;

		        if (isEditing) {
		            // Ch·∫ø ƒë·ªô ch·ªânh s·ª≠a - lu√¥n hi·ªÉn th·ªã c·ªôt thao t√°c
		            row.innerHTML = `
		                <td class="text-center"><input type="text" class="form-control form-control-sm" value="${hp.maHocPhan || ''}" id="edit-maHocPhan"></td>
		                <td><input type="text" class="form-control form-control-sm" value="${hp.tenHocPhan || ''}" id="edit-tenHocPhan"></td>
		                <td class="text-center"><input type="number" class="form-control form-control-sm" value="${hp.soTinChi || ''}" id="edit-soTinChi"></td>
		                <td class="text-center"><input type="text" class="form-control form-control-sm" value="${hp.tienQuyet || ''}" id="edit-tienQuyet"></td>
		                <td class="text-center"><input type="number" class="form-control form-control-sm" value="${hp.soCa || ''}" id="edit-soCa"></td>
		                <td class="text-center"><input type="text" class="form-control form-control-sm" value="${hp.maGiangVien || ''}" id="edit-maGiangVien"></td>
		                <td class="text-center"><input type="text" class="form-control form-control-sm" value="${hp.nganhPhuTrach || ''}" id="edit-nganhPhuTrach"></td>
		                <td class="text-center">
		                    ${hp.danhSachThayThe && hp.danhSachThayThe.length > 0 ? 
		                        `<button class="btn btn-sm btn-info" type="button" disabled>
		                            Xem (${hp.danhSachThayThe.length})
		                        </button>` : 
		                        'Kh√¥ng c√≥'}
		                </td>
		                <td class="text-center">
		                    <button class="btn btn-success btn-sm mr-1" onclick="luuHocPhan(${hp.id})">
		                        <i class="fas fa-save"></i> L∆∞u
		                    </button>
		                    <button class="btn btn-secondary btn-sm" onclick="huySuaHocPhan(${hp.id})">
		                        <i class="fas fa-times"></i> H·ªßy
		                    </button>
		                </td>
		            `;
		        } else {
		            // Ch·∫ø ƒë·ªô xem th√¥ng th∆∞·ªùng
		            row.innerHTML = `
		                <td class="text-center">${hp.maHocPhan || ''}</td>
		                <td>${hp.tenHocPhan || ''}</td>
		                <td class="text-center">${hp.soTinChi || ''}</td>
		                <td>${hp.tienQuyet || ''}</td>
		                <td class="text-center">${hp.soCa || ''}</td>
		                <td class="text-center">${hp.maGiangVien ? `${hp.maGiangVien} - ${hp.lienLac || ''}` : ''}</td>
		                <td class="text-center">${hp.nganhPhuTrach || ''}</td>
		                <td class="text-center">
		                    ${hp.danhSachThayThe && hp.danhSachThayThe.length > 0 ? 
		                        `<button class="btn btn-sm btn-info" type="button" data-toggle="collapse" data-target="#${accordionId}" aria-expanded="false" aria-controls="${accordionId}">
		                            Xem (${hp.danhSachThayThe.length})
		                        </button>` : 
		                        'Kh√¥ng c√≥'}
		                    ${isAdmin ? 
		                        `<button class="btn btn-sm btn-success ml-2" onclick="showThemHocPhanThayTheModal('${hp.maHocPhan}')">
		                            <i class="fas fa-plus"></i> Th√™m
		                        </button>` : 
		                        ''}
		                </td>
		                ${isAdmin ? `
		                    <td class="text-center">
		                        <button class="btn btn-primary btn-sm mr-1" onclick="batDauSuaHocPhan(${hp.id})">
		                            <i class="fas fa-edit"></i> S·ª≠a
		                        </button>
		                        <button class="btn btn-danger btn-sm" onclick="xoaHocPhan(${hp.id}, this)">
		                            <i class="fas fa-trash-alt"></i> X√≥a
		                        </button>
		                    </td>
		                ` : ''}
		            `;
		        }

		        container.appendChild(row);

		        // Ph·∫ßn accordion cho h·ªçc ph·∫ßn thay th·∫ø
		        if (!isEditing && hp.danhSachThayThe && hp.danhSachThayThe.length > 0) {
		            const accordionRow = document.createElement('tr');
		            accordionRow.className = 'bg-light';
		            
		            accordionRow.innerHTML = `
		                <td colspan="${isAdmin ? '9' : '8'}" class="p-0 border-top-0">
		                    <div class="collapse" id="${accordionId}">
		                        <div class="p-3">
		                            <h6 class="font-weight-bold mb-3">Danh s√°ch h·ªçc ph·∫ßn thay th·∫ø cho ${hp.maHocPhan}</h6>
		                            <table class="table table-sm table-bordered">
		                                <thead class="thead-light">
		                                    <tr class="text-center">
		                                        <th>M√£ HP thay th·∫ø</th>
		                                        <th>T√™n HP thay th·∫ø</th>
												<th>S·ªë t√≠n ch·ªâ</th>
		                                        <th>√Åp d·ª•ng t·ª´ kh√≥a</th>
		                                        <th>√Åp d·ª•ng ƒë·∫øn kh√≥a</th>
		                                        ${isAdmin ? '<th>Thao t√°c</th>' : ''}
		                                    </tr>
		                                </thead>
		                                <tbody>
		                                    ${hp.danhSachThayThe.map(thayThe => `
		                                        <tr class="text-center">
		                                            <td>${thayThe.maHocPhanThayThe || ''}</td>
		                                            <td>${thayThe.tenHocPhanThayThe || ''}</td>
													<td>${thayThe.soTinChi || ''}</td>
		                                            <td>${thayThe.khoaApDungTu || ''}</td>
		                                            <td>${thayThe.khoaApDungDen || ''}</td>
		                                            ${isAdmin ? `
		                                                <td>
		                                                    <button class="btn btn-sm btn-danger" onclick="xoaHocPhanThayThe('${hp.maHocPhan}', '${thayThe.maHocPhanThayThe}', this)">
		                                                        <i class="fas fa-trash-alt"></i> X√≥a
		                                                    </button>
		                                                </td>
		                                            ` : ''}
		                                        </tr>
		                                    `).join('')}
		                                </tbody>
		                            </table>
		                        </div>
		                    </div>
		                </td>
		            `;
		            container.appendChild(accordionRow);
		        }
		    });
		}
				
		function resetSearch() {
		    currentSearchKeyword = '';
		    $('#loadingDsHp').show(); // Hi·ªÉn th·ªã loading
		    
		    // G·ªçi API load l·∫°i danh s√°ch ƒë·∫ßy ƒë·ªß
		    fetch('/api/v1/hocphan-with-thaythe')
		        .then(response => {
		            if (!response.ok) throw new Error('T·∫£i danh s√°ch th·∫•t b·∫°i');
		            return response.json();
		        })
		        .then(data => {
		            $('#loadingDsHp').hide();
		            document.getElementById('searchInfoContainer').style.display = 'none';
		            danhSachHocPhanGlobal = data; // C·∫≠p nh·∫≠t danh s√°ch global
		            renderDanhSachHocPhan(data);
		        })
		        .catch(error => {
		            console.error('L·ªói khi t·∫£i danh s√°ch:', error);
		            alert('C√≥ l·ªói x·∫£y ra: ' + error.message);
		            $('#loadingDsHp').hide();
		        });
		}
		
		function batDauSuaHocPhan(id) {
		    renderDanhSachHocPhan(danhSachDangHienThi, id);
		}

		function huySuaHocPhan(id) {
		    renderDanhSachHocPhan(danhSachDangHienThi);
		}

	//l∆∞u h·ªçc ph·∫ßn sau khi s·ª≠a
		function luuHocPhan(id) {
		    const hocPhan = danhSachHocPhanGlobal.find(hp => hp.id === id);
		    if (!hocPhan) return;

		    // L·∫•y gi√° tr·ªã t·ª´ c√°c input
		    const updatedHocPhan = {
		        ...hocPhan,
		        maHocPhan: document.getElementById('edit-maHocPhan').value,
		        tenHocPhan: document.getElementById('edit-tenHocPhan').value,
		        soTinChi: parseInt(document.getElementById('edit-soTinChi').value),
		        tienQuyet: document.getElementById('edit-tienQuyet').value,
				soCa: document.getElementById('edit-soCa').value,
		        maGiangVien: document.getElementById('edit-maGiangVien').value,
		        nganhPhuTrach: document.getElementById('edit-nganhPhuTrach').value
		    };

		    // G·ªçi API c·∫≠p nh·∫≠t
		    fetch(`/api/v1/hocphan/${id}`, {
		        method: 'PUT',
		        headers: {
		            'Content-Type': 'application/json',
		        },
		        body: JSON.stringify(updatedHocPhan)
		    })
		    .then(response => {
		        if (!response.ok) throw new Error('C·∫≠p nh·∫≠t th·∫•t b·∫°i');
		        return response.json();
		    })
		    .then(data => {
		        alert('C·∫≠p nh·∫≠t th√†nh c√¥ng');
		        
		        // C·∫≠p nh·∫≠t d·ªØ li·ªáu trong danh s√°ch global
		        const index = danhSachHocPhanGlobal.findIndex(hp => hp.id === id);
		        if (index !== -1) {
		            danhSachHocPhanGlobal[index] = data;
		        }

		        // N·∫øu ƒëang trong ch·∫ø ƒë·ªô t√¨m ki·∫øm
		        if (currentSearchKeyword) {
		            // C·∫≠p nh·∫≠t l·∫°i danh s√°ch t√¨m ki·∫øm
		            const updatedSearchResults = danhSachHocPhanGlobal.filter(hp => 
		                hp.maHocPhan.toLowerCase().includes(currentSearchKeyword.toLowerCase()) || 
		                hp.tenHocPhan.toLowerCase().includes(currentSearchKeyword.toLowerCase())
		            );
		            renderDanhSachHocPhan(updatedSearchResults);
		        } else {
		            // N·∫øu kh√¥ng ph·∫£i ch·∫ø ƒë·ªô t√¨m ki·∫øm
		            renderDanhSachHocPhan(danhSachHocPhanGlobal);
		        }
		    })
		    .catch(error => {
		        console.error('L·ªói khi c·∫≠p nh·∫≠t:', error);
		        alert('C√≥ l·ªói x·∫£y ra: ' + error.message);
		    });
		}
		
		// Hi·ªÉn th·ªã/·∫©n ph·∫ßn th√™m h·ªçc ph·∫ßn m·ªõi
		function toggleThemHocPhan() {
		    const container = document.getElementById('themHocPhanContainer');
		    if (container.style.display === 'none') {
		        container.style.display = 'block';
		    } else {
		        container.style.display = 'none';
		    }
		}

		// Th√™m d√≤ng m·ªõi ƒë·ªÉ nh·∫≠p h·ªçc ph·∫ßn
		function themDongHocPhanMoi() {
		    const tbody = document.getElementById('themHocPhanTableBody');
		    const newRow = document.createElement('tr');
		    newRow.innerHTML = `
			<td><input type="text" class="form-control form-control-sm" placeholder="M√£ HP"></td>
				<td><input type="text" class="form-control form-control-sm" placeholder="M√£ HP hi·ªán t·∫°i"></td>
                <td><input type="text" class="form-control form-control-sm" placeholder="T√™n h·ªçc ph·∫ßn"></td>
                <td><input type="number" class="form-control form-control-sm" placeholder="S·ªë t√≠n ch·ªâ"></td>
                <td><input type="text" class="form-control form-control-sm" placeholder="ƒêK ti√™n quy·∫øt"></td>
				<td><input type="number" class="form-control form-control-sm" placeholder="S·ªë ca"></td>
                <td><input type="text" class="form-control form-control-sm" placeholder="GV ph·ª• tr√°ch"></td>
				<td><input type="text" class="form-control form-control-sm" placeholder="M√£ GV"></td>
                <td><input type="text" class="form-control form-control-sm" placeholder="Ng√†nh ph·ª• tr√°ch"></td>
		        <td class="text-center">
		            <button class="btn btn-danger btn-sm" onclick="xoaDongThemHocPhan(this)">
		                <i class="fas fa-trash-alt"></i>
		            </button>
		        </td>
		    `;
		    tbody.appendChild(newRow);
		}

		// X√≥a d√≤ng th√™m h·ªçc ph·∫ßn
		function xoaDongThemHocPhan(button) {
		    const row = button.closest('tr');
		    row.remove();
		}

		// L∆∞u t·∫•t c·∫£ h·ªçc ph·∫ßn m·ªõi
		function luuHocPhanMoi() {
		    const rows = document.querySelectorAll('#themHocPhanTableBody tr');
		    const hocPhanList = [];
		    
		    rows.forEach(row => {
		        const inputs = row.querySelectorAll('input');
		        const hocPhan = {
		            maHocPhan: inputs[0].value,
					maHocPhanHienTai: inputs[1].value,
		            tenHocPhan: inputs[2].value,
		            soTinChi: inputs[3].value ? parseInt(inputs[3].value) : null,
		            tienQuyet: inputs[4].value,
					soCa: inputs[5].value,
					lienLac:inputs[6].value,
		            maGiangVien: inputs[7].value,
		            nganhPhuTrach: inputs[8].value
		        };
		        
		        if (hocPhan.maHocPhan) {
		            hocPhanList.push(hocPhan);
		        }
		    });
		    
		    if (hocPhanList.length === 0) {
		        alert('Vui l√≤ng nh·∫≠p √≠t nh·∫•t m·ªôt h·ªçc ph·∫ßn h·ª£p l·ªá');
		        return;
		    }
		    
			fetch('/api/v1/hocphan/batch', {
			    method: 'POST',
			    headers: {
			        'Content-Type': 'application/json',
			    },
			    body: JSON.stringify(hocPhanList)
			})
			.then(response => {
			    if (!response.ok) throw new Error('L∆∞u h·ªçc ph·∫ßn th·∫•t b·∫°i');
			    return response.json();
			})
			.then(data => {
			    try {
			        const savedCount = data.saved?.length || 0;
			        const skippedCount = data.skipped?.length || 0;
			        const skippedMaHocPhan = data.skipped?.map(hp => hp.maHocPhan).join(', ') || 'Kh√¥ng c√≥';

			        let message = `‚úÖ ƒê√£ th√™m ${savedCount} h·ªçc ph·∫ßn m·ªõi.\n`;
			        if (skippedCount > 0) {
			            message += `‚ö†Ô∏è B·ªè qua ${skippedCount} h·ªçc ph·∫ßn b·ªã tr√πng m√£:\n${skippedMaHocPhan}`;
			        }

			        alert(message);
			        toggleThemHocPhan();
			        loadDanhSachHocPhan(); // T·∫£i l·∫°i danh s√°ch
			    } catch (e) {
			        console.error('L·ªói x·ª≠ l√Ω d·ªØ li·ªáu tr·∫£ v·ªÅ:', e);
			        alert('‚ùå ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω k·∫øt qu·∫£ t·ª´ server.');
			    }
			})
			.catch(error => {
			    console.error('L·ªói khi l∆∞u h·ªçc ph·∫ßn:', error);
			    alert('‚ùå ƒê√£ x·∫£y ra l·ªói khi l∆∞u h·ªçc ph·∫ßn. Vui l√≤ng th·ª≠ l·∫°i.\nChi ti·∫øt: ' + error.message);
			});


		}
		
		// Hi·ªÉn th·ªã modal th√™m h·ªçc ph·∫ßn thay th·∫ø
		function showThemHocPhanThayTheModal(maHocPhanGoc) {
		    $('#maHocPhanGoc').val(maHocPhanGoc);
		    $('#khoaApDungTu').val('');
		    $('#khoaApDungDen').val('');
		    $('#danhSachThayTheContainer').html('');
		    themDongHocPhanThayThe(); // m·∫∑c ƒë·ªãnh c√≥ 1 d√≤ng
		    $('#themHocPhanThayTheModal').modal('show');
		}

		
		function themDongHocPhanThayThe() {
		    const container = document.getElementById('danhSachThayTheContainer');

		    const html = `
		        <div class="form-row mb-2 thay-the-item">
		            <div class="col">
		                <input type="text" class="form-control" placeholder="M√£ h·ªçc ph·∫ßn thay th·∫ø" name="maHocPhanThayThe">
		            </div>
		            <div class="col-auto">
		                <button type="button" class="btn btn-danger btn-sm" onclick="this.closest('.thay-the-item').remove()">X√≥a</button>
		            </div>
		        </div>
		    `;

		    container.insertAdjacentHTML('beforeend', html);
		}
		
		// G·ª≠i y√™u c·∫ßu th√™m h·ªçc ph·∫ßn thay th·∫ø
		function themHocPhanThayThe() {
		    const maHocPhanGoc = $('#maHocPhanGoc').val();
		    const khoaApDungTu = $('#khoaApDungTu').val();
		    const khoaApDungDen = $('#khoaApDungDen').val();

		    const items = document.querySelectorAll('#danhSachThayTheContainer .thay-the-item');
		    const dsThayThe = [];

		    items.forEach(item => {
		        const ma = item.querySelector('[name="maHocPhanThayThe"]').value.trim();
		        if (ma) {
		            dsThayThe.push({
		                maHocPhanGoc: maHocPhanGoc,
		                maHocPhanThayThe: ma,
		                khoaApDungTu: khoaApDungTu || null,
		                khoaApDungDen: khoaApDungDen || null
		            });
		        }
		    });

		    if (dsThayThe.length === 0) {
		        alert('Vui l√≤ng nh·∫≠p √≠t nh·∫•t m·ªôt m√£ h·ªçc ph·∫ßn thay th·∫ø');
		        return;
		    }

			fetch('/api/v1/hocphan-thaythe/batch', {
			    method: 'POST',
			    headers: { 'Content-Type': 'application/json' },
			    body: JSON.stringify(dsThayThe)
			})
			.then(async response => {
			    if (!response.ok) {
			        const contentType = response.headers.get('content-type');
			        if (contentType && contentType.includes('application/json')) {
			            const errData = await response.json();
			            throw new Error(errData.message || 'L·ªói khi th√™m h·ªçc ph·∫ßn thay th·∫ø');
			        } else {
			            const errText = await response.text();
			            throw new Error(errText || 'L·ªói kh√¥ng r√µ t·ª´ server');
			        }
			    }
			    return response.json();
			})
			.then(data => {
			    alert('Th√™m h·ªçc ph·∫ßn thay th·∫ø th√†nh c√¥ng');
			    $('#themHocPhanThayTheModal').modal('hide');
			    //loadDanhSachHocPhan();
			})
			.catch(error => {
			    console.error('L·ªói khi g·ª≠i API:', error);
			    alert('C√≥ l·ªói: Kh√¥ng t√¨m th·∫•y HP thay th·∫ø / th√™m HP thay th·∫ø b·ªã l·∫∑p' );
			});
		}

		// H√†m x√≥a h·ªçc ph·∫ßn thay th·∫ø
		function xoaHocPhanThayThe(maHocPhanGoc, maHocPhanThayThe, buttonElement) {
		    if (!confirm(`B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªçc ph·∫ßn thay th·∫ø ${maHocPhanThayThe}?`)) {
		        return;
		    }

		    fetch(`/api/v1/hocphan-thaythe?maHocPhanGoc=${encodeURIComponent(maHocPhanGoc)}&maHocPhanThayThe=${encodeURIComponent(maHocPhanThayThe)}`, {
		        method: 'DELETE',
		        headers: {
		            'Accept': 'application/json',
		        }
		    })
		    .then(async response => {
		        const data = await response.text();
		        if (!response.ok) {
		            throw new Error(data || 'X√≥a h·ªçc ph·∫ßn thay th·∫ø th·∫•t b·∫°i');
		        }
		        return data;
		    })
		    .then(message => {
		        alert(message || 'X√≥a h·ªçc ph·∫ßn thay th·∫ø th√†nh c√¥ng');
		        const row = buttonElement.closest('tr');
		        row.remove();
		    })
		    .catch(error => {
		        console.error('L·ªói khi x√≥a h·ªçc ph·∫ßn thay th·∫ø:', error);
		        alert(error.message);
		    });
		}
		//t√¨m ki·∫øm h·ªçc ph·∫ßn trong ds all hp
		function timKiemHocPhan(keyword) {
			isSearching = true;
		    currentSearchKeyword = keyword;
		    $('#loadingDsHp').show();
		    
		    fetch(`/api/v1/hocphan-with-thaythe/search?keyword=${encodeURIComponent(keyword)}`)
		        .then(response => {
		            if (!response.ok) throw new Error('T√¨m ki·∫øm th·∫•t b·∫°i');
		            return response.json();
		        })
		        .then(data => {
		            $('#loadingDsHp').hide();
		            document.getElementById('searchInfoContainer').style.display = 'block';
		            document.getElementById('searchInfoText').textContent = 
		                `ƒêang hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm cho: ${keyword}`;
		            renderDanhSachHocPhan(data);
		        })
		        .catch(error => {
		            console.error('L·ªói khi t√¨m ki·∫øm:', error);
		            alert('C√≥ l·ªói x·∫£y ra: ' + error.message);
		        });
		}
		
		// H√†m hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm h·ªçc ph·∫ßn ƒë·ªÉ th√™m v√†o ct
		function renderHocPhanSearchResults(results) {
		    const container = $('#hocPhanSearchResults');
		    container.empty();
		    
		    if (results.length === 0) {
		        container.append('<div class="col-12"><div class="alert alert-info">Kh√¥ng t√¨m th·∫•y h·ªçc ph·∫ßn ph√π h·ª£p</div></div>');
		        return;
		    }
		    
		    results.forEach(hocPhan => {
		        const isSelected = selectedHocPhanIds.includes(hocPhan.id);
		        
		        container.append(`
		            <div class="col-md-4 mb-3">
		                <div class="card hoc-phan-card ${isSelected ? 'border-success' : ''}">
		                    <div class="card-body">
		                        <h5 class="card-title">${hocPhan.maHocPhan} - ${hocPhan.tenHocPhan}</h5>
		                        <p class="card-text">
		                            <strong>S·ªë t√≠n ch·ªâ:</strong> ${hocPhan.soTinChi}<br>
		                            <strong>M√£ HP m·ªõi:</strong> ${hocPhan.maHocPhanHienTai}<br>
									<strong>ƒêK ti√™n quy·∫øt:</strong> ${hocPhan.tienQuyet|| 'Kh√¥ng'}<br>
									<strong>GV ph·ª• tr√°ch:</strong> ${hocPhan.maGiangVien}-${hocPhan.lienLac}<br>
		                        </p>
		                        <button class="btn btn-${isSelected ? 'danger' : 'primary'}" 
		                                onclick="${isSelected ? 'removeHocPhanFromSelection' : 'addHocPhanToSelection'}(${hocPhan.id})">
		                            ${isSelected ? 'B·ªè ch·ªçn' : 'Ch·ªçn'}
		                        </button>
		                    </div>
		                </div>
		            </div>
		        `);
		    });
		}
		
		$(document).ready(function() {
		    // B∆∞·ªõc 1: T·∫°o ch∆∞∆°ng tr√¨nh h·ªçc
		    $('#createChuongTrinhForm').submit(function(e) {
		        e.preventDefault();
		        createChuongTrinhHoc();
		    });

		    // B∆∞·ªõc 2: Th√™m lo·∫°i h·ªçc ph·∫ßn
		    $('#addLoaiHocPhanForm').submit(function(e) {
		        e.preventDefault();
		        addLoaiHocPhan();
		    });

		    // B∆∞·ªõc 3: Th√™m h·ªçc ph·∫ßn v√†o lo·∫°i
			// ===============================================
			// ========== L∆ØU H·ªåC PH·∫¶N ========================
			// ===============================================

			$('#btnSaveHocPhan').click(function () {
			  if (selectedHocPhanIds.length === 0) {
			    alert('Vui l√≤ng ch·ªçn h·ªçc ph·∫ßn');
			    return;
			  }

			  const { source, id } = currentContext || {};

			  let url = '';
			  if (source === 'loai') {
			    url = `/api/v1/chuongtrinhhoc/ctlhp/${id}/hocphan`;
			  } else if (source === 'tohop') {
			    url = `/api/v1/chuongtrinhhoc/tohop/${id}/hocphan`;
			  } else if (source === 'nhom') {
			    url = `/api/v1/chuongtrinhhoc/tohopnhommon/${id}/hocphan`;
			  } else {
			    alert('‚ùå Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c ngu·ªìn th√™m h·ªçc ph·∫ßn');
			    return;
			  }

			  $.ajax({
			    url: url,
			    type: 'POST',
			    contentType: 'application/json',
			    data: JSON.stringify(selectedHocPhanIds),
			    success() {
			      $('#addHocPhanModal').modal('hide');
			      alert(`‚úÖ ƒê√£ th√™m ${selectedHocPhanIds.length} h·ªçc ph·∫ßn`);

			      if (source === 'loai') {
			        loadToHopForLoai(id);
			      } else if (source === 'tohop') {
			        loadNhomForToHop(id);
			      } else if (source === 'nhom') {
			        loadDanhSachChuongTrinhHoc();
			      }
			    },
			    error(xhr) {
			      alert('‚ùå L·ªói khi th√™m h·ªçc ph·∫ßn: ' + (xhr.responseJSON?.message || xhr.statusText));
			    }
			  });
			});
		    // S·ª± ki·ªán t√¨m ki·∫øm h·ªçc ph·∫ßn
		    $('#btnSearchHocPhan').click(function() {
		        const keyword = $('#searchHocPhanInput').val();
		        searchHocPhan(keyword);
		    });
			// ‚úÖ Load danh s√°ch ngay khi trang m·ªü
			fetchDanhSachChuongTrinhHoc(); 
			
			
			// Toggle collapse ƒë·ªÉ hi·ªán/·∫©n danh s√°ch t·ªï h·ª£p
			$(document).on('click', '.toggle-collapse', function() {
			  const tgt = $(this).data('target');
			  $(tgt).toggle();
			  $(this).find('i').toggleClass('fa-chevron-down fa-chevron-up');
			});

			// M·ªü modal T·∫°o t·ªï h·ª£p
			$(document).on('click', '.btn-create-tohop', function() {
			  const loaiId = $(this).data('loai-id'),
			        loaiName = $(this).data('loai-name');
			  $('#ctxLoaiId').val(loaiId);
			  $('#modalLoaiTitle').text(loaiName);
			  $('#createToHopModal').modal('show');
			});

			// X·ª≠ l√Ω submit T·∫°o t·ªï h·ª£p
			$('#createToHopForm').submit(function(e) {
			  e.preventDefault();
			  const payload = {
			    chuongTrinhHocLoaiHocPhanId: $('#ctxLoaiId').val(),
			    tenToHop: $('#toHopTen').val(),
			    soTinChiToiThieu: $('#toHopTinChi').val()||null,
			    soLuongMonToiThieu: $('#toHopSoLuong').val()||null,
			    batBuocHocTatCa: $('#toHopBatBuoc').is(':checked')
			  };
			  $.ajax({
			    url: '/api/v1/chuongtrinhhoc/tohop',
			    type: 'POST',
			    contentType: 'application/json',
			    data: JSON.stringify(payload),
			    success() {
			      $('#createToHopModal').modal('hide');
			      loadToHopForLoai(payload.chuongTrinhHocLoaiHocPhanId);
			    }
			  });
			  
			});
			// H√†m load danh s√°ch t·ªï h·ª£p cho 1 lo·∫°i

			// M·ªü modal T·∫°o nh√≥m
			$(document).on('click', '.btn-create-nhom', function() {
			  const hopId = $(this).data('hop-id'),
			        hopName = $(this).data('hop-name');
			  $('#ctxToHopId').val(hopId);
			  $('#modalToHopTitle').text(hopName);
			  $('#createNhomModal').modal('show');
			});

			// Submit t·∫°o nh√≥m
			$('#createNhomForm').submit(function(e) {
			  e.preventDefault();

			  const payload = {
			    tenNhom: $('#nhomTen').val(),
			    toHopHocPhan: {
			      id: parseInt($('#ctxToHopId').val())
			    }
			  };

			  $.ajax({
			    url: '/api/v1/chuongtrinhhoc/tohopnhommon',
			    type: 'POST',
			    contentType: 'application/json',
			    data: JSON.stringify(payload),
			    success() {
			      $('#createNhomModal').modal('hide');
			      loadNhomForToHop(payload.toHopHocPhan.id); // n·∫°p l·∫°i danh s√°ch nh√≥m
			    },
			    error(xhr) {
			      alert('‚ùå L·ªói khi t·∫°o nh√≥m m√¥n: ' + (xhr.responseJSON?.message || xhr.statusText));
			    }
			  });
			});
			
			
			//x·ª≠ l√≠ l·ªçc h·ªçc ph·∫ßn
			$(document).on('click', '#btnCheckHocPhan', function() {
			  const maSinhVien = $('#maSinhVienInput').val().trim();

			  if (!maSinhVien) {
			    alert('Vui l√≤ng nh·∫≠p m√£ sinh vi√™n');
			    return;
			  }
			  $('#loadingKiemTra').show();
			  $('#ketQuaHocPhanConThieu').html('');			  
				
			  // üéØ Th√™m API l·∫•y t√™n sinh vi√™n
		      $.get(`/api/v1/sinhvien/${maSinhVien}/thong-tin`, function(data) {
		          if (data && data.ten) {
		              $('#kiemtra-header').html(`<h5 class="text-primary">üë®‚Äçüéì K·∫øt qu·∫£ h·ªçc ph·∫ßn c·ªßa: <strong>${data.ten} (${maSinhVien})</strong></h5>`);
		          } else {
		              $('#kiemtra-header').html(`<h5 class="text-primary">üë®‚Äçüéì K·∫øt qu·∫£ h·ªçc ph·∫ßn c·ªßa m√£ sinh vi√™n: <strong>${maSinhVien}</strong></h5>`);
		          }
		      }).fail(function() {
		          $('#kiemtra-header').html(`<h5 class="text-primary">üë®‚Äçüéì K·∫øt qu·∫£ h·ªçc ph·∫ßn c·ªßa m√£ sinh vi√™n: <strong>${maSinhVien}</strong></h5>`);
		      });
				  
			  // üåÄ API h·ªçc ph·∫ßn c√≤n thi·∫øu
			  $.get(`/api/v1/sinhvien/${maSinhVien}/hocphan-conthieu`, function(data) {
			    renderHocPhanConThieu(data);
			  }).fail(function() {
			    $('#ketQuaHocPhanConThieu').html('<div class="text-danger">‚ùå Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu h·ªçc ph·∫ßn c√≤n thi·∫øu.</div>');
			  }).always(function() {
			  					   
			    $('#loadingKiemTra').hide();
			    
			  });			  
			});			
		});
		// Render h·ªçc ph·∫ßn c√≤n thi·∫øu
		// Render h·ªçc ph·∫ßn c√≤n thi·∫øu v·ªõi accordion h·ªçc ph·∫ßn thay th·∫ø
		function renderHocPhanConThieu(list) {
		    if (list.length === 0) {
		        $('#ketQuaHocPhanConThieu').html('<div class="text-success">‚úÖ Kh√¥ng c√≤n h·ªçc ph·∫ßn n√†o thi·∫øu!</div>');
		        return;
		    }

		    let html = '<h5 class="text-primary mb-3"></h5>';
		    
		    list.forEach((loai, index) => {
		        html += `
		            <div class="card mb-4">
		                <div class="card-header bg-light">
		                    <h6 class="m-0 font-weight-bold text-dark">${index + 1}. ${loai.tenLoaiHocPhan}</h6>
		                </div>
		                <div class="card-body p-0">
		                    <div class="table-responsive">
		                        <table class="table table-bordered table-sm mb-0">
		                            <thead class="thead-light text-center">
		                                <tr>
		                                    <th>STT</th>
		                                    <th>N·ªôi dung</th>
		                                    <th>M√£ HP</th>
		                                    <th>M√£ HP hi·ªán t·∫°i</th>
		                                    <th>ƒêK ti√™n quy·∫øt</th>
		                                    <th>S·ªë t√≠n ch·ªâ</th>
		                                    <th>GV ph·ª• tr√°ch</th>
		                                    <th>HP thay th·∫ø</th>
		                                    <th>Ghi ch√∫</th>
		                                </tr>
		                            </thead>
		                            <tbody>
		        `;
		        
		        loai.hocPhansConThieu.forEach((hp, idx) => {
		            const accordionId = `thaythe-${hp.maHocPhan ? hp.maHocPhan.replace(/\s+/g, '-') : ''}-${idx}`;
		            const hasThayThe = hp.danhSachThayThe && hp.danhSachThayThe.length > 0;
		            
		            html += `
		                <tr class="hoc-phan-goc">
		                    <td class="text-center">${idx + 1}</td>
		                    <td>${hp.noiDung}</td>
		                    <td class="text-center">${hp.maHocPhan || ''}</td>
		                    <td class="text-center">${hp.maHocPhanHienTai || ''}</td>
		                    <td class="text-center">${hp.tienQuyet || ''}</td>
		                    <td class="text-center">${hp.soTinChi || ''}</td>
		                    <td class="text-center">${hp.maGiangVien || ''}${hp.lienLac ? ' - ' + hp.lienLac : ''}</td>
		                    <td class="text-center">
		                        ${hasThayThe ? 
		                            `<button class="btn btn-sm btn-info" type="button" data-toggle="collapse" 
		                                data-target="#${accordionId}" aria-expanded="false" aria-controls="${accordionId}">
		                                Xem (${hp.danhSachThayThe.length})
		                            </button>` : 
		                            'Kh√¥ng c√≥'}
		                    </td>
		                    <td class="text-center">${hp.ghiChu || ''}</td>
		                </tr>
		            `;
		            
		            // Th√™m h√†ng accordion cho h·ªçc ph·∫ßn thay th·∫ø
		            if (hasThayThe) {
		                html += `
		                    <tr class="bg-light">
		                        <td colspan="9" class="p-0 border-top-0">
		                            <div class="collapse" id="${accordionId}">
		                                <div class="p-3">
		                                    <h6 class="font-weight-bold mb-3">Danh s√°ch h·ªçc ph·∫ßn thay th·∫ø cho ${hp.maHocPhan || hp.noiDung}</h6>
		                                    <table class="table table-sm table-bordered">
		                                        <thead class="thead-light">
		                                            <tr class="text-center">
		                                                <th>M√£ HP thay th·∫ø</th>
		                                                <th>T√™n HP thay th·∫ø</th>
		                                                <th>S·ªë t√≠n ch·ªâ</th>
		                                                <th>√Åp d·ª•ng t·ª´ kh√≥a</th>
		                                                <th>√Åp d·ª•ng ƒë·∫øn kh√≥a</th>
		                                            </tr>
		                                        </thead>
		                                        <tbody>
		                                            ${hp.danhSachThayThe.map(thayThe => `
		                                                <tr class="text-center">
		                                                    <td>${thayThe.maHocPhanThayThe || ''}</td>
		                                                    <td>${thayThe.tenHocPhanThayThe || ''}</td>
		                                                    <td>${thayThe.soTinChi || ''}</td>
		                                                    <td>${thayThe.khoaApDungTu || ''}</td>
		                                                    <td>${thayThe.khoaApDungDen || ''}</td>
		                                                </tr>
		                                            `).join('')}
		                                        </tbody>
		                                    </table>
		                                </div>
		                            </div>
		                        </td>
		                    </tr>
		                `;
		            }
		        });
		        
		        html += `
		                            </tbody>
		                        </table>
		                    </div>
		                </div>
		            </div>
		        `;
		    });

		    $('#ketQuaHocPhanConThieu').html(html);
		    
		    // Kh·ªüi t·∫°o tooltip n·∫øu c√≥
		    if ($('[data-toggle="tooltip"]').length) {
		        $('[data-toggle="tooltip"]').tooltip();
		    }
		}
		
		function autoKiemTraHocPhan(maSinhVien) {		    
		    $('#loadingKiemTra').show();
		    $('#ketQuaHocPhanConThieu').html('');
			// üéØ Th√™m: Hi·ªÉn th·ªã t√™n sinh vi√™n ƒëang ki·ªÉm tra
		    const currentUser = JSON.parse(localStorage.getItem('taiKhoan'));
		    if (currentUser && currentUser.userName === maSinhVien) {
		        const hoTen = currentUser.ten || '';
		        $('#kiemtra-header').html(`<h5 class="text-primary">üë®‚Äçüéì K·∫øt qu·∫£ ki·ªÉm tra h·ªçc ph·∫ßn c·ªßa: <strong>${hoTen} (${currentUser.userName})</strong></h5>`);
		    }
			
		    $.get(`/api/v1/sinhvien/${maSinhVien}/hocphan-conthieu`, function(data) {
		        renderHocPhanConThieu(data);
		    }).fail(function() {
		        $('#ketQuaHocPhanConThieu').html('<div class="text-danger">‚ùå Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu h·ªçc ph·∫ßn c√≤n thi·∫øu.</div>');
		    }).always(function() {
		    
		    $('#loadingKiemTra').hide();
		    });
		}

		function loadToHopForLoai(loaiId) {
		  $.get(`/api/v1/chuongtrinhhoc/ctlhp/${loaiId}/tohop`, function(toHops) {
		    const $ul = $(`#toHopList_${loaiId}`).empty();
		    
		    if (toHops.length === 0) {
		      $ul.append('<li class="list-group-item text-muted">Ch∆∞a c√≥ t·ªï h·ª£p n√†o</li>');
		      return;
		    }
	
		    toHops.forEach(hop => {
		      const $li = $(`
		        <li class="list-group-item">
		          <div class="d-flex justify-content-between align-items-center">
		            <div>
		              <strong>${hop.tenToHop}</strong>
		              ${hop.soTinChiToiThieu ? `<small class="text-muted ml-2">(T·ªëi thi·ªÉu: ${hop.soTinChiToiThieu} t√≠n ch·ªâ)</small>` : ''}
		            </div>
		            <div>
		              <button class="btn btn-sm btn-primary btn-add-hocphan-tohop" data-hop-id="${hop.id}" data-hop-name="${hop.tenToHop}">
		                <i class="fas fa-plus"></i> Th√™m HP
		              </button>
		              <button class="btn btn-sm btn-secondary btn-create-nhom" data-hop-id="${hop.id}" data-hop-name="${hop.tenToHop}">
		                <i class="fas fa-layer-group"></i> T·∫°o nh√≥m
		              </button>
		            </div>
		          </div>
		          <ul class="mt-2 list-unstyled" id="nhomList_${hop.id}"></ul>
		        </li>
		      `);
		      
		      $ul.append($li);
		      loadNhomForToHop(hop.id);
		    });
		  });
		}
		function loadNhomForToHop(hopId) {
		  $.get(`/api/v1/chuongtrinhhoc/tohop/${hopId}/tohopnhommon`, function(nhoms) {
		    const $ul = $(`#nhomList_${hopId}`).empty();
		    
		    if (nhoms.length === 0) {
		      $ul.append('<li class="text-muted small">Ch∆∞a c√≥ nh√≥m m√¥n n√†o</li>');
		      return;
		    }
	
		    nhoms.forEach(n => {
		      $ul.append(`
		        <li class="mb-2">
		          <div class="d-flex justify-content-between align-items-center bg-light p-2 rounded">
		            <span>${n.tenNhom}</span>
		            <button class="btn btn-sm btn-primary btn-add-hocphan-tonhom" data-nhom-id="${n.id}" data-nhom-name="${n.tenNhom}">
		              <i class="fas fa-plus"></i> Th√™m HP
		            </button>
		          </div>
		        </li>
		      `);
		    });
		  });
		}
		
		function fetchDanhSachChuongTrinhHoc() {
		    $.ajax({
		        url: '/api/v1/chuongtrinhhoc',
		        type: 'GET',
		        success: function (data) {
		            const list = $('#chuongTrinhHocList');
		            list.empty();
		            data.forEach(ct => {
		                list.append(`
		                    <tr>
		                        <td>${convertChuyenNganh(ct.chuyenNganh)}</td>
		                        <td>${ct.khoa}</td>
		                        <td>${ct.id}</td>
		                    </tr>
		                `);
		            });
		        },
		        error: function () {
		            $('#chuongTrinhHocList').html('<tr><td colspan="3">L·ªói khi t·∫£i danh s√°ch</td></tr>');
		        }
		    });
		}

		// H√†m t·∫°o ch∆∞∆°ng tr√¨nh h·ªçc m·ªõi
		function createChuongTrinhHoc() {
		    const chuyenNganh = $('#chuyenNganh').val();
		    const khoa = $('#khoa').val();

		    if (!chuyenNganh || !khoa) {
		        alert('Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß chuy√™n ng√†nh v√† kh√≥a h·ªçc');
		        return;
		    }

		    $('#loadingIndicator').show();

		    $.ajax({
		        url: '/api/v1/chuongtrinhhoc/full',
		        type: 'POST',
		        contentType: 'application/json',
		        data: JSON.stringify({
		            chuyenNganh: chuyenNganh,
		            khoa: khoa
		        }),
		        success: function (response) {
		            const ct = response.data;
		            currentChuongTrinhId = ct.id;

		            $('#createdChuongTrinhInfo').text(`${convertChuyenNganh(ct.chuyenNganh)} - Kh√≥a ${ct.khoa}`);

		            // ‚úÖ Hi·ªán b∆∞·ªõc 2
		            $('#step1').hide();
		            $('#step2').show();
					// üëâ Show loading tr∆∞·ªõc khi load
					  $('#loadingLoaiHocPhan').show();
					  $('#loaiHocPhanList').empty();
		            // ‚úÖ Hi·ªán danh s√°ch lo·∫°i h·ªçc ph·∫ßn lu√¥n
		            //renderLoaiHocPhanFromResponse(ct.cacLoaiHocPhan);
					// üëâ G·ªåI API L·∫§Y DANH S√ÅCH LO·∫†I H·ªåC PH·∫¶N SAU KHI T·∫†O
			        $.get(`/api/v1/chuongtrinhhoc/${currentChuongTrinhId}/loaihocphan`, function(loaiList) {
			            renderLoaiHocPhanFromResponse(loaiList);
						}).always(function() {
							$('#loadingLoaiHocPhan').hide();
			        });
					
		            // ‚úÖ Load h·ªçc ph·∫ßn cho ch·ª©c nƒÉng th√™m h·ªçc ph·∫ßn
		            loadDanhSachHocPhan();
					
		            // Sau khi t·∫°o ch∆∞∆°ng tr√¨nh h·ªçc th√†nh c√¥ng
					loadDanhSachChuongTrinhHoc();

		        },
		        error: function (xhr) {
		            alert('L·ªói khi t·∫°o ch∆∞∆°ng tr√¨nh h·ªçc: ' + (xhr.responseJSON?.message || xhr.statusText));
		        },
		        complete: function () {
		            $('#loadingIndicator').hide();
		        }
		    });
		}
		// X·ª≠ l√Ω khi click t·∫°o m·ªôt ch∆∞∆°ng tr√¨nh h·ªçc c≈© trong danh s√°ch  ƒë·ªÉ c·∫≠p nh·∫≠t
		$(document).on('click', '#chuongTrinhHocList tbody tr', function () {
		  const chuongTrinhId = $(this).data('id');
		  const chuyenNganh = $(this).find('td:eq(0)').text().trim();
		  const khoa = $(this).find('td:eq(1)').text().trim();

		  if (!chuongTrinhId) return;

		  currentChuongTrinhId = chuongTrinhId;

		  $('#createdChuongTrinhInfo').text(`${chuyenNganh} - Kh√≥a ${khoa}`);

		  // Chuy·ªÉn sang b∆∞·ªõc 2
		  $('#step1').hide();
		  $('#step2').show();

		  // üëâ Show loading tr∆∞·ªõc khi load
		  $('#loadingLoaiHocPhan').show();
		  $('#loaiHocPhanList').empty();

		  // G·ªçi API l·∫•y danh s√°ch lo·∫°i h·ªçc ph·∫ßn
		  $.get(`/api/v1/chuongtrinhhoc/${chuongTrinhId}/loaihocphan`, function (loaiList) {
		    console.log('üßæ D·ªØ li·ªáu lo·∫°i h·ªçc ph·∫ßn t·ª´ ch∆∞∆°ng tr√¨nh c√≥ s·∫µn:', loaiList);
		    renderLoaiHocPhanFromResponse(loaiList);
		  }).fail(function() {
		    alert('‚ùå L·ªói khi t·∫£i lo·∫°i h·ªçc ph·∫ßn.');
		  }).always(function() {
		    $('#loadingLoaiHocPhan').hide(); // üëâ ·∫®n loading d√π th√†nh c√¥ng hay th·∫•t b·∫°i
		  });

		  // G·ªçi load danh s√°ch h·ªçc ph·∫ßn cho modal
		  loadDanhSachHocPhan();
		});
		


		// ===== C√ÅC H√ÄM X·ª¨ L√ù M·ªöI =====

		// H√†m hi·ªÉn th·ªã danh s√°ch lo·∫°i h·ªçc ph·∫ßn m·∫∑c ƒë·ªãnh khi t·∫°o ch∆∞∆°ng tr√¨nh h·ªçc m·ªõi
		function renderLoaiHocPhanFromResponse(cacLoaiHocPhan) {
		  console.log("üßæ S·ªë lo·∫°i h·ªçc ph·∫ßn:", cacLoaiHocPhan.length, cacLoaiHocPhan);

		  const $list = $('#loaiHocPhanList').empty();

		  cacLoaiHocPhan.forEach((loai, index) => {
		    try {
		      console.log(`üîπ ƒêang render lo·∫°i ${index + 1}:`, loai);

		      $list.append(`
			  <tr id="loaiRow_${loai.id}">
			      <td>
			        ${convertLoaiHocPhan(loai.loaiHocPhan)}
			        <button class="btn btn-sm btn-link toggle-collapse" data-target="#collapse_${loai.id}">
			          <i class="fas fa-chevron-down"></i>
			        </button>
			      </td>
			      <td>
			        <input type="number" class="form-control so-tin-chi" id="soTinChi_${loai.id}" value="${loai.soTinChiToiThieu ?? ''}">
			      </td>
			      <td>
			        <input type="text" class="form-control chu-thich" id="chuThich_${loai.id}" placeholder="Ghi ch√∫..." value="${loai.chuThich || ''}">
			        <input type="text" class="form-control mt-1 ma-bat-dau" id="maBatDau_${loai.id}" placeholder="M√£ b·∫Øt ƒë·∫ßu ƒë∆∞·ª£c t√≠nh VD: CS,IS,MA" value="${loai.maBatDauDuocTinh || ''}">
			      </td>
			      <td>			        
					<button class="btn btn-primary btn-sm btn-save-tinchi"
					        data-loai-enum="${loai.loaiHocPhan}" 
					        data-loai-id="${loai.id}">
							<i class="fas fa-save"></i> C·∫≠p nh·∫≠t lo·∫°i HP
					</button>	
			        <button class="btn btn-info btn-sm btn-add-hocphan" data-loai-id="${loai.id}" data-loai-name="${convertLoaiHocPhan(loai.loaiHocPhan)}">
			          <i class="fas fa-plus"></i> Th√™m HP
			        </button>
					<button class="btn btn-success btn-sm btn-create-tohop" data-loai-id="${loai.id}" data-loai-name="${convertLoaiHocPhan(loai.loaiHocPhan)}">
						<i class="fas fa-plus"></i> T·∫°o t·ªï h·ª£p
					</button>
			      </td>
			    </tr>
		        <tr class="collapse-row" id="collapse_${loai.id}" style="display:none;">
		          <td colspan="4" class="p-0">
		            <div class="card card-body">
		              <ul class="list-group mb-2" id="toHopList_${loai.id}"></ul>
		            </div>
		          </td>
		        </tr>
		      `);

		      loadToHopForLoai(loai.id); // ‚ö† C√≥ th·ªÉ l·ªói t·∫°i ƒë√¢y n·∫øu d·ªØ li·ªáu t·ªï h·ª£p b·ªã null

		    } catch (err) {
		      console.error(`‚ùå L·ªói khi render lo·∫°i h·ªçc ph·∫ßn index ${index}:`, err);
		    }
		  });
		}

		
		// X·ª≠ l√Ω m·ªü modal th√™m h·ªçc ph·∫ßn t·ª´ c√°c ngu·ªìn kh√°c nhau
		function openAddHocPhanModal(source, id, name) {
		console.log('üß© M·ªü modal t·ª´ ngu·ªìn:', source, 'id:', id, 'name:', name);
		  currentContext = { source, id, name };
		  $('#modalLoaiHocPhanTitle').text(name || 'Th√™m h·ªçc ph·∫ßn');
		  
		  // Reset danh s√°ch ch·ªçn
		  selectedHocPhanIds = [];
		  updateSelectedHocPhanList();
		  
		  // Hi·ªÉn th·ªã modal
		  $('#addHocPhanModal').modal('show');
		}

		// X·ª≠ l√Ω khi click n√∫t th√™m h·ªçc ph·∫ßn t·ª´ c√°c ngu·ªìn
		$(document).on('click', '.btn-add-hocphan', function() {
		  const loaiId = $(this).data('loai-id');
		  const loaiName = $(this).data('loai-name');
		  openAddHocPhanModal('loai', loaiId, loaiName);
		});

		$(document).on('click', '.btn-add-hocphan-tohop', function() {
		  const hopId = $(this).data('hop-id');
		  if (!hopId) {
		     console.warn('‚ö† Kh√¥ng t√¨m th·∫•y hopId t·ª´ button:', this);
		     return;
		   }
		  const hopName = $(this).data('hop-name');
		  openAddHocPhanModal('tohop', hopId, hopName);
		});

		$(document).on('click', '.btn-add-hocphan-tonhom', function() {
		  const nhomId = $(this).data('nhom-id');
		  const nhomName = $(this).data('nhom-name');
		  openAddHocPhanModal('nhom', nhomId, nhomName);
		});


		// H√†m c·∫≠p nh·∫≠t lo·∫°i h·ªçc ph·∫ßn(s·ªë t√≠n t·ªëi thi·ªÉu, ghi ch√∫, m√£ b·∫Øt ƒë·∫ßu)
		function saveSoTinChi(loaiId) {
		    const soTinChi = $(`#soTinChi_${loaiId}`).val();
		    const chuThich = $(`#chuThich_${loaiId}`).val();
		    const maBatDau = $(`#maBatDau_${loaiId}`).val();

		    $.ajax({
		        url: `/api/v1/chuongtrinhhoc/${currentChuongTrinhId}/loaihocphan/${loaiId}`,
		        type: 'PUT',
		        contentType: 'application/json',
		        data: JSON.stringify({
		            soTinChiToiThieu: soTinChi || null,
		            chuThich: chuThich || null,
		            maBatDauDuocTinh: maBatDau || null
		        }),
		        success: function() {
		            alert('‚úÖ ƒê√£ l∆∞u th√¥ng tin lo·∫°i h·ªçc ph·∫ßn');
		            loadDanhSachChuongTrinhHoc(); // Load l·∫°i danh s√°ch n·∫øu c·∫ßn
		        },
		        error: function(xhr) {
		            alert('‚ùå L·ªói khi l∆∞u: ' + (xhr.responseJSON?.message || xhr.statusText));
		        }
		    });
		}


		// H√†m th√™m lo·∫°i h·ªçc ph·∫ßn v√†o ch∆∞∆°ng tr√¨nh
		function addLoaiHocPhan() {
		    const chuongTrinhId = $('#chuongTrinhHocId').val();
		    const loaiHocPhan = $('#loaiHocPhan').val();
		    const soTinChiToiThieu = $('#soTinChiToiThieu').val();

		    if (!loaiHocPhan ) {
		        alert('Vui l√≤ng ch·ªçn lo·∫°i h·ªçc ph·∫ßn');
		        return;
		    }

		    $('#loadingIndicator').show();

			// T·∫°o payload ƒë√∫ng c·∫•u tr√∫c
		    const payload = {
		        loaiHocPhan: loaiHocPhan,
		        soTinChiToiThieu: parseInt(soTinChiToiThieu)
		    };

		    console.log("G·ª≠i d·ªØ li·ªáu:", payload); // Ki·ªÉm tra d·ªØ li·ªáu tr∆∞·ªõc khi g·ª≠i

		    $.ajax({
		        url: `/api/v1/chuongtrinhhoc/${chuongTrinhId}/loaihocphan`,
		        type: 'POST',
		        contentType: 'application/json',
		        data: JSON.stringify(payload),
		        success: function(response) {
		            console.log("Ph·∫£n h·ªìi t·ª´ server:", response); // Ki·ªÉm tra ph·∫£n h·ªìi
		            
		            // Th√™m v√†o danh s√°ch hi·ªÉn th·ªã
		            addLoaiHocPhanToTable({
		                id: response.id || Date.now(), // T·∫°m th·ªùi s·ª≠ d·ª•ng timestamp n·∫øu kh√¥ng c√≥ id
		                loaiHocPhan: loaiHocPhan,
		                soTinChiToiThieu: soTinChiToiThieu
		            });
		            
		            // Reset form
		            $('#loaiHocPhan').val('');
		            $('#soTinChiToiThieu').val('');
		            
		            // K√≠ch ho·∫°t n√∫t th√™m h·ªçc ph·∫ßn
		            $('#btnAddHocPhan').prop('disabled', false);
		        },
		        error: function(xhr) {
		            console.error("L·ªói chi ti·∫øt:", xhr.responseJSON); // Log l·ªói chi ti·∫øt
		            alert('L·ªói khi th√™m lo·∫°i h·ªçc ph·∫ßn: ' + 
		                 (xhr.responseJSON?.message || xhr.statusText || 'Unknown error'));
		        },
		        complete: function() {
		            $('#loadingIndicator').hide();
		        }
		    });
		}

		// H√†m th√™m lo·∫°i h·ªçc ph·∫ßn v√†o b·∫£ng
		function addLoaiHocPhanToTable(loaiHocPhan) {
		    danhSachLoaiHocPhanDaThem.push(loaiHocPhan);
		    
		    $('#loaiHocPhanList').append(`
		        <tr id="loaiHocPhanRow_${loaiHocPhan.id}">
		            <td>${convertLoaiHocPhan(loaiHocPhan.loaiHocPhan)}</td>
		            <td>${loaiHocPhan.soTinChiToiThieu}</td>
		            <td>
		                <button class="btn btn-primary btn-sm" onclick="addHocPhanToLoai('${loaiHocPhan.id}', '${loaiHocPhan.loaiHocPhan}')">
		                    <i class="fas fa-plus"></i> Th√™m HP
		                </button>
		                <button class="btn btn-danger btn-sm" onclick="deleteLoaiHocPhan('${loaiHocPhan.id}')">
		                    <i class="fas fa-trash"></i> X√≥a
		                </button>
		            </td>
		        </tr>
		    `);
		}

		// H√†m x√≥a lo·∫°i h·ªçc ph·∫ßn
		function deleteLoaiHocPhan(loaiHocPhanId) {
		    if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a lo·∫°i h·ªçc ph·∫ßn n√†y?')) return;

		    $('#loadingIndicator').show();

		    $.ajax({
		        url: `/api/v1/chuongtrinhhoc/loaihocphan/${loaiHocPhanId}`,
		        type: 'DELETE',
		        success: function(response) {
		            $(`#loaiHocPhanRow_${loaiHocPhanId}`).remove();
		            danhSachLoaiHocPhanDaThem = danhSachLoaiHocPhanDaThem.filter(item => item.id !== loaiHocPhanId);
		            
		            if (danhSachLoaiHocPhanDaThem.length === 0) {
		                $('#btnAddHocPhan').prop('disabled', true);
		            }
		        },
		        error: function(xhr) {
		            alert('L·ªói khi x√≥a lo·∫°i h·ªçc ph·∫ßn: ' + (xhr.responseJSON?.message || xhr.statusText));
		        },
		        complete: function() {
		            $('#loadingIndicator').hide();
		        }
		    });
		}

		// H√†m chuy·ªÉn sang b∆∞·ªõc th√™m h·ªçc ph·∫ßn v√†o lo·∫°i
		function addHocPhanToLoai(loaiHocPhanId, loaiHocPhan) {
			console.log('B·∫Øt ƒë·∫ßu th√™m HP v√†o lo·∫°i', loaiHocPhanId, loaiHocPhan);
		    currentLoaiHocPhanId = loaiHocPhanId;
		    $('#selectedLoaiHocPhan').text(convertLoaiHocPhan(loaiHocPhan));
		    
		    // Reset danh s√°ch h·ªçc ph·∫ßn ƒë√£ ch·ªçn
		    selectedHocPhanIds = [];
		    updateSelectedHocPhanList();
		    
		    // T·∫£i l·∫°i danh s√°ch h·ªçc ph·∫ßn tr∆∞·ªõc khi hi·ªÉn th·ªã
		    loadDanhSachHocPhan().then(() => {
		        // Hi·ªÉn th·ªã b∆∞·ªõc 3 sau khi t·∫£i xong
		        $('#step2').hide();
		        $('#step3').show();
		        
		        // Hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm ban ƒë·∫ßu (t·∫•t c·∫£ h·ªçc ph·∫ßn)
		        renderHocPhanSearchResults(danhSachHocPhan);
		    });
		}

		// H√†m quay l·∫°i t·ª´ b∆∞·ªõc 3 sang b∆∞·ªõc 2
		function backToLoaiHocPhan() {
		    $('#step3').hide();
		    $('#step2').show();
		}

		// H√†m l∆∞u h·ªçc ph·∫ßn v√†o lo·∫°i h·ªçc ph·∫ßn
		function saveHocPhanToLoai() {
		    if (selectedHocPhanIds.length === 0) {
		        alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt h·ªçc ph·∫ßn');
		        return;
		    }
		
		    $('#loadingIndicator').show();
		
		    // T·∫°o payload d·∫°ng danh s√°ch v·ªõi lo·∫°i h·ªçc ph·∫ßn ƒë√£ ch·ªçn
		    const payload = selectedHocPhanIds.map(hocPhanId => ({
		        hocPhanId: hocPhanId,
		        loaiHocPhan: currentLoaiHocPhanId // S·ª≠ d·ª•ng lo·∫°i h·ªçc ph·∫ßn hi·ªán t·∫°i
		    }));
		
		    $.ajax({
		        url: `/api/v1/chuongtrinhhoc/${currentChuongTrinhId}/hocphans`,
		        type: 'POST',
		        contentType: 'application/json',
		        data: JSON.stringify(payload),
		        success: function(response) {
		            alert(`ƒê√£ th√™m ${selectedHocPhanIds.length} h·ªçc ph·∫ßn v√†o lo·∫°i h·ªçc ph·∫ßn`);
		            $('#addHocPhanModal').modal('hide');
		            
		            // Load l·∫°i danh s√°ch ch∆∞∆°ng tr√¨nh h·ªçc ƒë·ªÉ c·∫≠p nh·∫≠t
		            loadDanhSachChuongTrinhHoc();
		        },
		        error: function(xhr) {
		            alert('L·ªói khi th√™m h·ªçc ph·∫ßn: ' + (xhr.responseJSON?.message || xhr.statusText));
		        },
		        complete: function() {
		            $('#loadingIndicator').hide();
		        }
		    });
		}		
		// H√†m th√™m h·ªçc ph·∫ßn v√†o danh s√°ch ch·ªçn
		function addHocPhanToSelection(hocPhanId) {
		    if (!selectedHocPhanIds.includes(hocPhanId)) {
		        selectedHocPhanIds.push(hocPhanId);
		        updateSelectedHocPhanList();
		        renderHocPhanSearchResults(filterHocPhanSearchResults());
		    }
		}

		// H√†m x√≥a h·ªçc ph·∫ßn kh·ªèi danh s√°ch ch·ªçn
		function removeHocPhanFromSelection(hocPhanId) {
		    selectedHocPhanIds = selectedHocPhanIds.filter(id => id !== hocPhanId);
		    updateSelectedHocPhanList();
		    renderHocPhanSearchResults(filterHocPhanSearchResults());
		}

		// H√†m c·∫≠p nh·∫≠t danh s√°ch h·ªçc ph·∫ßn ƒë√£ ch·ªçn
		function updateSelectedHocPhanList() {
		    const container = $('#selectedHocPhanList');
		    container.empty();
		    
		    if (selectedHocPhanIds.length === 0) {
		        container.append('<div class="text-muted">Ch∆∞a c√≥ h·ªçc ph·∫ßn n√†o ƒë∆∞·ª£c ch·ªçn</div>');
		        return;
		    }
		    
		    selectedHocPhanIds.forEach(hocPhanId => {
		        const hocPhan = danhSachHocPhan.find(hp => hp.id === hocPhanId);
		        if (hocPhan) {
		            container.append(`
		                <div class="selected-hoc-phan-item bg-light p-2 m-1 rounded">
		                    ${hocPhan.maHocPhan} - ${hocPhan.tenHocPhan}
		                    <span class="text-danger ml-2" style="cursor:pointer" 
		                          onclick="removeHocPhanFromSelection(${hocPhan.id})">
		                        <i class="fas fa-times"></i>
		                    </span>
		                </div>
		            `);
		        }
		    });
		}

		// H√†m l·ªçc k·∫øt qu·∫£ t√¨m ki·∫øm (lo·∫°i b·ªè c√°c h·ªçc ph·∫ßn ƒë√£ ch·ªçn)
		function filterHocPhanSearchResults() {
		    const keyword = $('#searchHocPhanInput').val().toLowerCase() || '';
		    return danhSachHocPhan.filter(hp => 
		        !selectedHocPhanIds.includes(hp.id) &&
		        (hp.maHocPhan.toLowerCase().includes(keyword) || 
		         hp.tenHocPhan.toLowerCase().includes(keyword))
		    );
		}
		
		function loadDanhSachChuongTrinhHoc() {
		    $('#loadingChuongTrinhHoc').show();
		    $('#chuongTrinhHocContainer').hide();

		    $.ajax({
		        url: '/api/v1/chuongtrinhhoc',
		        type: 'GET',
		        cache: false,
		        success: function(response) {
		            window.danhSachChuongTrinhHoc = response;
		            renderDanhSachChuongTrinhHoc(response);
		        },
		        error: function(xhr) {
		            console.error('L·ªói API:', xhr.responseJSON || xhr.statusText);
		            $('#chuongTrinhHocContainer').html(
		                '<div class="alert alert-danger">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu. ' + 
		                (xhr.responseJSON?.message || xhr.statusText) + '</div>'
		            );
		        },
		        complete: function () {
		            $('#loadingChuongTrinhHoc').hide();
		            $('#chuongTrinhHocContainer').show();
		        }
		    });
		}
	    
		
		// H√†m hi·ªÉn th·ªã danh s√°ch ch∆∞∆°ng tr√¨nh h·ªçc theo kh√≥a v√† chuy√™n ng√†nh
		function renderDanhSachChuongTrinhHoc(data) {
		    const container = $('#chuongTrinhHocContainer');
		    container.empty();

		    if (data.length === 0) {
		        container.append('<div class="alert alert-info">Kh√¥ng c√≥ d·ªØ li·ªáu ch∆∞∆°ng tr√¨nh h·ªçc</div>');
		        return;
		    }

		    // Nh√≥m theo kh√≥a
		    const groupedByKhoa = {};
		    data.forEach(item => {
		        if (!groupedByKhoa[item.khoa]) {
		            groupedByKhoa[item.khoa] = [];
		        }
		        groupedByKhoa[item.khoa].push(item);
		    });

		    const sortedKhoas = Object.keys(groupedByKhoa).sort();

		    sortedKhoas.forEach(khoa => {
		        const khoaId = `khoa-body-${khoa}`;
		        const khoaGroup = $(`
		            <div class="khoa-group mb-3">
		                <div class="khoa-header bg-primary px-3 py-2 rounded d-flex justify-content-between align-items-center"
		                     style="color: #F5F5F5; cursor: pointer;"
		                     data-toggle="collapse"
		                     data-target="#${khoaId}"
		                     aria-expanded="false"
		                     aria-controls="${khoaId}">
		                    <strong>Kh√≥a: ${khoa}</strong>
		                    <i class="fas fa-chevron-down rotate-icon"></i>
		                </div>
		                <div id="${khoaId}" class="collapse mt-2"></div>
		            </div>
		        `);

		        const khoaBody = khoaGroup.find(`#${khoaId}`);

		        // Nh√≥m ch∆∞∆°ng tr√¨nh h·ªçc theo chuy√™n ng√†nh
		        const groupedByChuyenNganh = {};
		        groupedByKhoa[khoa].forEach(item => {
		            const chuyenNganhRaw = item.chuyenNganh;
		            if (!groupedByChuyenNganh[chuyenNganhRaw]) {
		                groupedByChuyenNganh[chuyenNganhRaw] = [];
		            }
		            groupedByChuyenNganh[chuyenNganhRaw].push(item);
		        });

		        Object.keys(groupedByChuyenNganh).forEach(chuyenNganhRaw => {
		            const chuongTrinhList = groupedByChuyenNganh[chuyenNganhRaw];
		            const chuongTrinh = chuongTrinhList[0];
		            const chuyenNganhLabel = convertChuyenNganh(chuyenNganhRaw);

		            let totalHocPhan = 0;
		            chuongTrinhList.forEach(ct => {
		                if (ct.hocPhans && ct.hocPhans.length > 0) {
		                    totalHocPhan += ct.hocPhans.length;
		                }
		            });
					const chuyenNganhCard = $(`
					    <div class="card chuyen-nganh-card mb-2" style="margin-bottom: 3px !important;">
					        <div class="card-body d-flex justify-content-between align-items-center p-1">
					            <!-- Tr√°i: T√™n chuy√™n ng√†nh -->
					            <div class="flex-shrink-0" style="color: #5a5c69; font-weight: bold; white-space: nowrap;margin-left: 20px;">
					                ${chuyenNganhLabel}
					            </div>


					            <!-- Ph·∫£i: N√∫t -->
					            <div class="text-nowrap">
					                <button class="btn btn-info btn-sm mr-2" onclick="xemChiTietTheoChuyenNganh('${khoa}', '${chuyenNganhRaw}')">
					                    <i class="fas fa-eye"></i> Xem chi ti·∫øt 
					                </button>
									${isAdminRole() ? `
					                <button class="btn btn-danger btn-sm" onclick="xoaChuongTrinhHocTheoChuyenNganh('${khoa}', '${chuyenNganhRaw}')">
					                    <i class="fas fa-trash"></i> X√≥a
					                </button>` : ''}
					            </div>
					        </div>
					    </div>
					`);

		            khoaBody.append(chuyenNganhCard);
		        });

		        container.append(khoaGroup);

		        // X·ª≠ l√Ω hi·ªáu ·ª©ng m≈©i t√™n quay l√™n/xu·ªëng
		        khoaGroup.find('.khoa-header').on('click', function () {
		            const icon = $(this).find('i');
		            icon.toggleClass('fa-chevron-down fa-chevron-up');
		        });
		    });
		}
		
		function toggleChuyenNganhTheoKhoa(khoa) {
		    const body = $(`#khoa-body-${khoa}`);
		    const icon = $(`.card-header[onclick="toggleChuyenNganhTheoKhoa('${khoa}')"] i`);

		    if (!body.hasClass('d-none')) {
		        body.addClass('d-none');
		        icon.removeClass('fa-chevron-up').addClass('fa-chevron-down');
		        return;
		    }

		    // ƒê·ªïi icon
		    icon.removeClass('fa-chevron-down').addClass('fa-chevron-up');

		    // N·∫øu ƒë√£ render th√¨ ch·ªâ show/hide
		    if (body.children().length > 0) {
		        body.removeClass('d-none');
		        return;
		    }

		    const chuongTrinhList = window.groupedChuongTrinhByKhoa[khoa];
		    const groupedByChuyenNganh = {};

		    chuongTrinhList.forEach(item => {
		        if (!groupedByChuyenNganh[item.chuyenNganh]) {
		            groupedByChuyenNganh[item.chuyenNganh] = [];
		        }
		        groupedByChuyenNganh[item.chuyenNganh].push(item);
		    });

		    Object.keys(groupedByChuyenNganh).forEach(chuyenNganhRaw => {
		        const chuyenNganhList = groupedByChuyenNganh[chuyenNganhRaw];
		        const chuyenNganhLabel = convertChuyenNganh(chuyenNganhRaw);

		        let totalHocPhan = 0;
		        chuyenNganhList.forEach(ct => {
		            if (ct.hocPhans && ct.hocPhans.length > 0) {
		                totalHocPhan += ct.hocPhans.length;
		            }
		        });

				const html = $(`
				    <div class="card chuyen-nganh-card mb-2">
				        <div class="card-body py-2 px-3 d-flex align-items-center justify-content-between flex-wrap">
				            <div class="font-weight-bold text-primary">
				                ${chuyenNganhLabel}
				            </div>
				            <div class="d-flex align-items-center gap-2 flex-wrap">
				                
				                <button class="btn btn-sm btn-info" onclick="xemChiTietTheoChuyenNganh('${khoa}', '${chuyenNganhRaw}')">
				                    <i class="fas fa-eye"></i> Xem chi ti·∫øt
				                </button>
								${isAdminRole() ? `
				                <button class="btn btn-danger btn-sm" onclick="xoaChuongTrinhHocTheoChuyenNganh('${khoa}', '${chuyenNganhRaw}')">
				                    <i class="fas fa-trash"></i> X√≥a
				                </button>` : ''}
				            </div>
				            <ul id="hocphan-list-${khoa}-${chuyenNganhRaw}" class="list-group mt-2 w-100 d-none"></ul>
				        </div>
				    </div>
				`);


		        body.append(html);
		    });

		    body.removeClass('d-none');
		}
		//h√†m x√≥a h·ªçc ph·∫ßn ·ªü danh s√°ch t·∫•t c·∫£ h·ªçc ph·∫ßn
		function xoaHocPhan(hocPhanId, buttonElement) {
		    if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªçc ph·∫ßn n√†y kh√¥ng?')) return;

		    $.ajax({
		        url: `/api/v1/hocphan/${hocPhanId}`,
		        type: 'DELETE',
		        success: function() {
		            alert('‚úÖ ƒê√£ x√≥a h·ªçc ph·∫ßn th√†nh c√¥ng');
		            // X√≥a d√≤ng kh·ªèi b·∫£ng n·∫øu c·∫ßn
		            if (buttonElement) {
		                $(buttonElement).closest('tr').remove();
		            }
		        },
		        error: function(xhr) {
		            alert('‚ùå L·ªói khi x√≥a h·ªçc ph·∫ßn: ' + (xhr.responseJSON?.message || xhr.statusText));
		            console.error(xhr);
		        }
		    });
		}
		

		function convertChuyenNganhToEnum(chuyenNganhText) {
		    const mapping = {
		        'C√¥ng ngh·ªá th√¥ng tin': 'CONG_NGHE_THONG_TIN',
		        'Khoa h·ªçc m√°y t√≠nh': 'KHOA_HOC_MAY_TINH',
		        'Tr√≠ tu·ªá nh√¢n t·∫°o': 'TRI_TUE_NHAN_TAO',
		        'H·ªá th·ªëng th√¥ng tin': 'HE_THONG_THONG_TIN',
		        'M·∫°ng m√°y t√≠nh v√† truy·ªÅn th√¥ng d·ªØ li·ªáu': 'MANG_MAY_TINH',
		        'K·∫ø to√°n': 'KE_TOAN',
		        'T√†i ch√≠nh - Ng√¢n h√†ng': 'TAI_CHINH_NGAN_HANG',
		        'Logistics': 'LOGISTIC',
		        'Qu·∫£n tr·ªã kinh doanh': 'QUAN_TRI_KINH_DOANH',
		        'Qu·∫£n tr·ªã kh√°ch s·∫°n': 'QUAN_TRI_KHACH_SAN',
		        'Marketing': 'MARKETING',
		        'Kinh t·∫ø qu·ªëc t·∫ø': 'KINH_TE_QUOC_TE',
		        'Lu·∫≠t kinh t·∫ø': 'LUAT_KINH_TE',
		        'Th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠': 'THUONG_MAI_DIEN_TU',
		        'D·ªãch v·ª• du l·ªãch - l·ªØ h√†nh': 'DICH_VU_DU_LICH_LU_HANH',
		        'Ng√¥n ng·ªØ Anh': 'NGON_NGU_ANH',
		        'Ng√¥n ng·ªØ Trung': 'NGON_NGU_TRUNG',
		        'Ng√¥n ng·ªØ Nh·∫≠t': 'NGON_NGU_NHAT',
		        'Ng√¥n ng·ªØ H√†n': 'NGON_NGU_HAN',
		        'Vi·ªát Nam h·ªçc': 'VIET_NAM_HOC',
		        'C√¥ng t√°c x√£ h·ªôi': 'CONG_TAC_XA_HOI',
		        'Truy·ªÅn th√¥ng ƒëa ph∆∞∆°ng ti·ªán': 'TRUYEN_THONG_DA_PHUONG_TIEN',
		        'Thi·∫øt k·∫ø ƒë·ªì h·ªça': 'THIET_KE_DO_HOA',
		        'ƒêi·ªÅu d∆∞·ª°ng': 'DIEU_DUONG',
		        'Dinh d∆∞·ª°ng': 'DINH_DUONG',
		        'Thanh nh·∫°c': 'THANH_NHAC'
		    };
		    
		    return mapping[chuyenNganhText] || chuyenNganhText;
		}
		function xoaHocPhanKhoiChuongTrinh(hocPhanId, loaiHocPhan, buttonElement) {
		  if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªçc ph·∫ßn n√†y kh·ªèi ch∆∞∆°ng tr√¨nh h·ªçc?')) {
		    return;
		  }

		  const chuongTrinhId = $('#detailChuongTrinhId').val();
		  
		  $('#loadingIndicator').show();

		  $.ajax({
		    url: `/api/v1/chuongtrinhhoc/${chuongTrinhId}/hocphan/${hocPhanId}`,
		    type: 'DELETE',
		    data: { loaiHocPhan: loaiHocPhan },
		    success: function() {
		      alert('‚úÖ ƒê√£ x√≥a h·ªçc ph·∫ßn th√†nh c√¥ng');
		      $(buttonElement).closest('tr').remove();

		      const tableBody = $(buttonElement).closest('tbody');
		      if (tableBody.find('tr').length === 0) {
		        tableBody.html('<tr><td colspan="10" class="text-center">Kh√¥ng c√≥ h·ªçc ph·∫ßn</td></tr>');
		      }

		      loadDanhSachChuongTrinhHoc();

		      // ƒê·ªìng b·ªô window.danhSachChuongTrinhHoc
		      const chuongTrinhIndex = window.danhSachChuongTrinhHoc.findIndex(ct => ct.id == chuongTrinhId);
		      if (chuongTrinhIndex >= 0) {
		        window.danhSachChuongTrinhHoc[chuongTrinhIndex].hocPhans =
		          (window.danhSachChuongTrinhHoc[chuongTrinhIndex].hocPhans || []).filter(
		            hp => hp.id != hocPhanId
		          );
		      }
		    },
		    error: function(xhr) {
		      alert('‚ùå L·ªói khi x√≥a h·ªçc ph·∫ßn: ' + (xhr.responseJSON?.message || xhr.statusText));
		    },
		    complete: function() {
		      $('#loadingIndicator').hide();
		    }
		  });
		}

		
		//H√†m toggle hi·ªÉn th·ªã body c·ªßa chuy√™n ng√†nh
        function toggleChuyenNganhBody(khoa, chuyenNganh) {
            $(`#chuyen-nganh-${khoa}-${chuyenNganh}`).slideToggle();
        }
		
		
		function xemChiTietTheoChuyenNganh(khoa, chuyenNganhEnum) {
		    const chuongTrinh = window.danhSachChuongTrinhHoc.find(ct =>
		        ct.khoa === khoa && ct.chuyenNganh === chuyenNganhEnum
		    );
		    
		    if (!chuongTrinh) {
		        alert("Kh√¥ng t√¨m th·∫•y ch∆∞∆°ng tr√¨nh h·ªçc");
		        return;
		    }

		    $('#detailChuyenNganh').text(convertChuyenNganh(chuongTrinh.chuyenNganh));
		    $('#detailKhoa').text(chuongTrinh.khoa);
		    $('#detailChuongTrinhId').val(chuongTrinh.id);

		    $('#chiTietChuongTrinhBody').html('<div class="text-center py-3"><i class="fas fa-spinner fa-spin text-primary"></i> ƒêang t·∫£i d·ªØ li·ªáu...</div>');

		    $('#detailModal').modal('show');

		    // G·ªçi API m·ªõi ƒë·ªÉ l·∫•y chi ti·∫øt
		    $.get(`/api/v1/chuongtrinhhoc/${chuongTrinh.id}/full-dto`, function(data) {
		        renderChiTietChuongTrinh(data);
		    }).fail(function() {
		        $('#chiTietChuongTrinhBody').html('<div class="text-danger text-center py-3">‚ùå L·ªói khi t·∫£i chi ti·∫øt ch∆∞∆°ng tr√¨nh h·ªçc.</div>');
		    });
		}
		function renderChiTietChuongTrinh(data) {
		    let html = '';
		
		    if (!data || !data.loaiHocPhans || data.loaiHocPhans.length === 0) {
		        html = '<div class="text-center text-muted py-3">Ch∆∞a c√≥ lo·∫°i h·ªçc ph·∫ßn.</div>';
		    } else {
		        data.loaiHocPhans.forEach(loai => {
		            html += `
		                <div class="card mb-4">
		                    <div class="card-header bg-primary text-white">
		                        ${convertLoaiHocPhan(loai.loaiHocPhan)}
		                        ${loai.soTinChiToiThieu ? ` - T·ªëi thi·ªÉu ${loai.soTinChiToiThieu} t√≠n ch·ªâ` : ''}
								${loai.chuThich ? ` <br><small> ${loai.chuThich}</small>` : ''}

		                    </div>
		                    <div class="card-body">
		            `;
		
					// N·∫øu l√† h·ªçc ph·∫ßn ngo√†i t·ªï h·ª£p
					if (loai.hocPhansNgoaiToHop && loai.hocPhansNgoaiToHop.length > 0) {
					    html += renderBangHocPhan(loai.hocPhansNgoaiToHop, {
					        type: 'loai',
					        ctId: loai.id
					    });
					}

					if (loai.toHops && loai.toHops.length > 0) {
					    loai.toHops.forEach(toHop => {
					        let dieuKien = [];

					        if (toHop.soTinChiToiThieu != null) {
					            dieuKien.push(`T·ªëi thi·ªÉu ${toHop.soTinChiToiThieu} t√≠n ch·ªâ`);
					        }
					        if (toHop.soLuongMonToiThieu != null) {
					            dieuKien.push(`T·ªëi thi·ªÉu ${toHop.soLuongMonToiThieu} m√¥n`);
					        }
					        if (toHop.batBuocHocTatCa) {
					            dieuKien.push(`B·∫Øt bu·ªôc h·ªçc t·∫•t c·∫£`);
					        }

					        const moTaDieuKien = dieuKien.length > 0 ? ` <small>(${dieuKien.join(', ')})</small>` : '';

							html += `
							    <div class="tohop-container mt-3 border p-2 rounded">
							        <div class="d-flex justify-content-between align-items-center">
							            <h6 class="bold text-dark mb-0">
							                T·ªï h·ª£p: ${toHop.tenToHop}${moTaDieuKien}
							            </h6>
										${isAdminRole() ? `
										<button class="btn btn-sm btn-danger btn-delete-tohop" data-tohopid="${toHop.id}">
										  <i class="fas fa-trash"></i> X√≥a t·ªï h·ª£p
										</button>
										` : ''}

							        </div>
							`;

							// üî• N·∫øu t·ªï h·ª£p kh√¥ng c√≥ nh√≥m m√¥n th√¨ m·ªõi render b·∫£ng h·ªçc ph·∫ßn
							if (!toHop.toHopNhomMons || toHop.toHopNhomMons.length === 0) {
								html += renderBangHocPhan(toHop.hocPhans, {
								        type: 'tohop',
								        toHopId: toHop.id
								    });
							}

							// Sau ƒë√≥ render nh√≥m m√¥n (n·∫øu c√≥)
							if (toHop.toHopNhomMons && toHop.toHopNhomMons.length > 0) {
							    toHop.toHopNhomMons.forEach(nhom => {
							        html += `
							            <div class="nhom-container ml-4 mt-3 p-2 border rounded">
							                <div class="d-flex justify-content-between align-items-center">
							                    <h6 class="text-dark mb-0">Nh√≥m m√¥n: ${nhom.tenNhom}</h6>
							                    
												${isAdminRole() ? `
													<button class="btn btn-sm btn-danger btn-delete-nhom" data-nhomid="${nhom.id}">
								                        <i class="fas fa-trash"></i> X√≥a nh√≥m
								                    </button>
												` : ''}

							                </div>
											${renderBangHocPhan(nhom.hocPhans, {
											                    type: 'nhom',
											                    nhomId: nhom.id
											                })}
							            </div>
							        `;
							    });
							}

							html += `</div>`; 
					    });
					}

		            html += `</div></div>`; // ƒë√≥ng card
		        });
		    }
		
		    $('#chiTietChuongTrinhBody').html(html);
		}
				
		function renderBangHocPhan(hocPhans = [], context = {}) {
		    let rows = hocPhans.map(hp => {
		        let btnDelete = '';

		        if (isAdminRole()) {
		            if (context.type === 'loai') {
		                btnDelete = `<button class="btn btn-sm btn-danger btn-delete-hocphan" data-type="loai" data-ctid="${context.ctId}" data-hpid="${hp.id}"><i class="fas fa-trash"></i> X√≥a</button>`;
		            } else if (context.type === 'tohop') {
		                btnDelete = `<button class="btn btn-sm btn-danger btn-delete-hocphan" data-type="tohop" data-tohopid="${context.toHopId}" data-hpid="${hp.id}"><i class="fas fa-trash"></i> X√≥a</button>`;
		            } else if (context.type === 'nhom') {
		                btnDelete = `<button class="btn btn-sm btn-danger btn-delete-hocphan" data-type="nhom" data-nhomid="${context.nhomId}" data-hpid="${hp.id}"><i class="fas fa-trash"></i> X√≥a</button>`;
		            }
		        }

		        const accordionId = `thaythe-${hp.maHocPhan.replace(/\s+/g, '-')}`;
		        const currentUser = JSON.parse(localStorage.getItem('taiKhoan'));
		        const currentUserRole = currentUser ? currentUser.dsQuyen : null;
		        const isAdmin = currentUserRole === 'quanTri' || currentUserRole === 'thuKy';

		        return `
		            <tr class="hoc-phan-goc">
		                <td class="text-center">${hp.maHocPhan || ''}</td>
		                <td>${hp.tenHocPhan || ''}</td>
		                <td class="text-center">${hp.soTinChi != null ? hp.soTinChi : ''}</td>
		                <td>${hp.tienQuyet || ''}</td>
		                <td class="text-center">${hp.soCa != null ? hp.soCa : ''}</td>
		                <td>
		                    ${hp.maGiangVien ? hp.maGiangVien : ''}${hp.maGiangVien && hp.lienLac ? ' - ' : ''}${hp.lienLac ? hp.lienLac : ''}
		                </td>		                
		                <td class="text-center">
		                    ${hp.danhSachThayThe && hp.danhSachThayThe.length > 0 ? 
		                        `<button class="btn btn-sm btn-info" type="button" data-toggle="collapse" data-target="#${accordionId}" aria-expanded="false" aria-controls="${accordionId}">
		                            Xem (${hp.danhSachThayThe.length})
		                        </button>` : 
		                        'Kh√¥ng c√≥'}
		                    ${isAdmin ? 
		                        `<button class="btn btn-sm btn-success ml-2" onclick="showThemHocPhanThayTheModal('${hp.maHocPhan}')">
		                            <i class="fas fa-plus"></i> Th√™m
		                        </button>` : 
		                        ''}
		                </td>
		                ${isAdminRole() ? `<td class="text-center">${btnDelete}</td>` : ''}
		            </tr>
		            ${hp.danhSachThayThe && hp.danhSachThayThe.length > 0 ? `
		            <tr class="bg-light">
		                <td colspan="${isAdminRole() ? '8' : '7'}" class="p-0 border-top-0">
		                    <div class="collapse" id="${accordionId}">
		                        <div class="p-3">
		                            <h6 class="font-weight-bold mb-3">Danh s√°ch h·ªçc ph·∫ßn thay th·∫ø cho ${hp.maHocPhan}</h6>
		                            <table class="table table-sm table-bordered">
		                                <thead class="thead-light">
		                                    <tr class="text-center">
		                                        <th>M√£ HP thay th·∫ø</th>
		                                        <th>T√™n HP thay th·∫ø</th>
												<th>S·ªë t√≠n ch·ªâ</th>
		                                        <th>√Åp d·ª•ng t·ª´ kh√≥a</th>
		                                        <th>√Åp d·ª•ng ƒë·∫øn kh√≥a</th>
		                                        ${isAdmin ? '<th>Thao t√°c</th>' : ''}
		                                    </tr>
		                                </thead>
		                                <tbody>
		                                    ${hp.danhSachThayThe.map(thayThe => `
		                                        <tr class="text-center">
		                                            <td>${thayThe.maHocPhanThayThe || ''}</td>
		                                            <td>${thayThe.tenHocPhanThayThe || ''}</td>
													<td>${thayThe.soTinChi || ''}</td>
		                                            <td>${thayThe.khoaApDungTu || ''}</td>
		                                            <td>${thayThe.khoaApDungDen || ''}</td>
		                                            ${isAdmin ? `
		                                            <td>
		                                                <button class="btn btn-sm btn-danger" onclick="xoaHocPhanThayThe('${hp.maHocPhan}', '${thayThe.maHocPhanThayThe}', this)">
		                                                    <i class="fas fa-trash-alt"></i> X√≥a
		                                                </button>
		                                            </td>
		                                            ` : ''}
		                                        </tr>
		                                    `).join('')}
		                                </tbody>
		                            </table>
		                        </div>
		                    </div>
		                </td>
		            </tr>
		            ` : ''}
		        `;
		    }).join('');

		    return `
		    <div class="table-responsive">
		        <table class="table table-bordered table-sm">
		            <thead>
		                <tr class="text-center">
		                    <th>M√£ HP</th>
		                    <th>T√™n h·ªçc ph·∫ßn</th>
		                    <th>S·ªë t√≠n ch·ªâ</th>
		                    <th>ƒêK ti√™n quy·∫øt</th>
		                    <th>S·ªë ca</th>
		                    <th>GV ph·ª• tr√°ch</th>		                    
		                    <th>HP thay th·∫ø</th>		                    
		                    ${isAdminRole() ? '<th>Thao t√°c</th>' : ''} 
		                </tr>
		            </thead>
		            <tbody>
		                ${rows}
		            </tbody>
		        </table>
		    </div>
		    `;
		}

		// H√†m x√≥a ch∆∞∆°ng tr√¨nh h·ªçc theo chuy√™n ng√†nh v√† kh√≥a				
        function xoaChuongTrinhHoc(id, buttonElement, showAlert = true) {
            $.ajax({
                url: `/api/v1/chuongtrinhhoc/${id}`,
                type: 'DELETE',
                success: function(response) {
                    if (showAlert) {
                        alert('X√≥a ch∆∞∆°ng tr√¨nh h·ªçc th√†nh c√¥ng');
                    }
                    if (buttonElement) {
                        $(buttonElement).closest('tr').remove();
                    }
                    loadDanhSachChuongTrinhHoc();
                },
                error: function(xhr, status, error) {
                    alert('C√≥ l·ªói khi x√≥a ch∆∞∆°ng tr√¨nh h·ªçc: ' + (xhr.responseJSON?.message || error));
                    console.error('Error:', xhr.responseJSON);
                }
            });
        }
		
		function xoaChuongTrinhHocTheoChuyenNganh(khoa, chuyenNganhRaw) {
		    const confirmDelete = confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ch∆∞∆°ng tr√¨nh h·ªçc: ${khoa} - ${convertChuyenNganh(chuyenNganhRaw)}?`);
		    if (!confirmDelete) return;

		    // Ki·ªÉm tra danh s√°ch ch∆∞∆°ng tr√¨nh h·ªçc c√≥ d·ªØ li·ªáu ch∆∞a
		    if (!window.danhSachChuongTrinhHoc || window.danhSachChuongTrinhHoc.length === 0) {
		        console.warn('‚ö†Ô∏è danhSachChuongTrinhHoc ch∆∞a ƒë∆∞·ª£c load');
		        alert('D·ªØ li·ªáu ch∆∞a s·∫µn s√†ng. Vui l√≤ng t·∫£i l·∫°i trang.');
		        return;
		    }

		    const chuongTrinh = window.danhSachChuongTrinhHoc.find(ct =>
		        ct.khoa === khoa && ct.chuyenNganh === chuyenNganhRaw
		    );

		    if (!chuongTrinh) {
		        alert(`Kh√¥ng t√¨m th·∫•y ch∆∞∆°ng tr√¨nh h·ªçc ƒë·ªÉ x√≥a (${khoa} - ${chuyenNganhRaw})`);
		        console.error('Kh√¥ng t√¨m th·∫•y v·ªõi:', khoa, chuyenNganhRaw);
		        return;
		    }

		    // G·ªçi h√†m x√≥a v·ªõi id t√¨m ƒë∆∞·ª£c
		    xoaChuongTrinhHoc(chuongTrinh.id);
		}

       

		// C·∫≠p nh·∫≠t h√†m resetForm
		function resetForm() {
		    $('#chuongTrinhHocForm')[0].reset();
		    selectedHocPhanIds = [];
		    updateSelectedHocPhanList();
		    renderHocPhanSearchResults(danhSachHocPhan);
		}
		
		// ===== C√ÅC H√ÄM X·ª¨ L√ù T√åM KI·∫æM =====

		// H√†m t√¨m ki·∫øm h·ªçc ph·∫ßn
		function searchHocPhan(keyword) {
		    if (!keyword) {
		        renderHocPhanSearchResults(danhSachHocPhan);
		        return;
		    }
		    
		    const results = danhSachHocPhan.filter(hp => 
		        hp.maHocPhan.toLowerCase().includes(keyword.toLowerCase()) || 
		        hp.tenHocPhan.toLowerCase().includes(keyword.toLowerCase())
		    );
		    
		    renderHocPhanSearchResults(results);
		}
		function searchMonHoc() {
		    const keyword = $('#searchMonHocInput').val().trim();

		    if (!keyword) {
		        alert('Vui l√≤ng nh·∫≠p m√£ ho·∫∑c t√™n m√¥n h·ªçc');
		        return;
		    }

		    // Hi·ªÉn th·ªã loading
		    $('#searchResultsContainer').html('<div class="text-center py-3"><i class="fas fa-spinner fa-spin"></i> ƒêang t√¨m ki·∫øm...</div>');
		    $('#searchResultModal').modal('show');

		    $.ajax({
		        url: '/api/v1/chuongtrinhhoc/search',
		        type: 'GET',
		        data: { 
		            keyword: keyword 
		        },
		        success: function(response) {
					console.log('üëâ K·∫æT QU·∫¢ T·ª™ BACKEND:', response); 
		            if (!response || response.length === 0) {
		                $('#searchResultsContainer').html('<div class="alert alert-info">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o ph√π h·ª£p</div>');
		                return;
		            }

		            displaySearchResults(response, keyword);
		        },
		        error: function(xhr) {
		            let errorMsg = 'C√≥ l·ªói khi t√¨m ki·∫øm';
		            if (xhr.responseJSON?.message) {
		                errorMsg = xhr.responseJSON.message;
		            }
		            $('#searchResultsContainer').html(`<div class="alert alert-danger">${errorMsg}</div>`);
		            console.error('L·ªói t√¨m ki·∫øm:', xhr.responseJSON);
		        }
		    });
		}

		function displaySearchResults(results, keyword) {
		    const container = $('#searchResultsContainer');
		    container.empty();

		    if (!results || results.length === 0) {
		        container.html('<div class="alert alert-info">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o ph√π h·ª£p</div>');
		        return;
		    }

		    const keywordLower = keyword.toLowerCase();
		    const monHocMap = new Map();

		    results.forEach(ct => {
		        if (ct.loaiHocPhans && ct.loaiHocPhans.length > 0) {
		            ct.loaiHocPhans.forEach(loai => {
		                // 1. H·ªçc ph·∫ßn ngo√†i t·ªï h·ª£p
		                if (loai.hocPhansNgoaiToHop && loai.hocPhansNgoaiToHop.length > 0) {
		                    loai.hocPhansNgoaiToHop.forEach(hp => {
		                        processHocPhan(hp, ct, `Lo·∫°i: ${convertLoaiHocPhan(loai.loaiHocPhan)}`, monHocMap, keywordLower);
		                    });
		                }
		                // 2. C√°c t·ªï h·ª£p
		                if (loai.toHops && loai.toHops.length > 0) {
		                    loai.toHops.forEach(toHop => {
		                        // 2.1 H·ªçc ph·∫ßn trong t·ªï h·ª£p
		                        if (toHop.hocPhans && toHop.hocPhans.length > 0) {
		                            toHop.hocPhans.forEach(hp => {
		                                processHocPhan(hp, ct, `T·ªï h·ª£p: ${toHop.tenToHop} (${convertLoaiHocPhan(loai.loaiHocPhan)})`, monHocMap, keywordLower);
		                            });
		                        }
		                        // 2.2 H·ªçc ph·∫ßn trong nh√≥m m√¥n
		                        if (toHop.toHopNhomMons && toHop.toHopNhomMons.length > 0) {
		                            toHop.toHopNhomMons.forEach(nhom => {
		                                if (nhom.hocPhans && nhom.hocPhans.length > 0) {
		                                    nhom.hocPhans.forEach(hp => {
		                                        processHocPhan(hp, ct, `Nh√≥m m√¥n: ${nhom.tenNhom} (T·ªï h·ª£p: ${toHop.tenToHop})`, monHocMap, keywordLower);
		                                    });
		                                }
		                            });
		                        }
		                    });
		                }
		            });
		        }
		    });

		    if (monHocMap.size === 0) {
		        container.html('<div class="alert alert-info">Kh√¥ng t√¨m th·∫•y h·ªçc ph·∫ßn ph√π h·ª£p trong ch∆∞∆°ng tr√¨nh h·ªçc</div>');
		        return;
		    }

		    monHocMap.forEach((value, key) => {
		        const { hocPhan, chuongTrinhInfos } = value;

		        const chuongTrinhListHTML = chuongTrinhInfos.map(info => {
		            return `<li><i class="fas fa-check text-success"></i> Kh√≥a <strong>${info.khoa}</strong> - ${info.chuyenNganh} - <em>${info.loaiHocPhan}</em></li>`;
		        }).join('');

		        container.append(`
		            <div class="card shadow mb-4 border-left-success">
		                <div class="card-body">
		                    <h4 class="text-success font-weight-bold">
		                        ${hocPhan.maHocPhan} - ${hocPhan.tenHocPhan}
		                    </h4>
		                    <p><strong>S·ªë t√≠n ch·ªâ:</strong> ${hocPhan.soTinChi ?? 'Ch∆∞a r√µ'}</p>
		                    <hr>
		                    <p class="mb-1 font-weight-bold">Thu·ªôc c√°c ch∆∞∆°ng tr√¨nh h·ªçc:</p>
		                    <ul class="mb-0">
		                        ${chuongTrinhListHTML}
		                    </ul>
		                </div>
		            </div>
		        `);
		    });
		}

		// C·∫≠p nh·∫≠t l·∫°i h√†m n√†y c≈©ng
		function processHocPhan(hp, chuongTrinh, moTaLoai, monHocMap, keywordLower) {
		    if (!hp || !hp.maHocPhan || !hp.tenHocPhan) return;

		    const matchMa = hp.maHocPhan.toLowerCase().includes(keywordLower);
		    const matchTen = hp.tenHocPhan.toLowerCase().includes(keywordLower);

		    if (!matchMa && !matchTen) return;

		    const key = `${hp.maHocPhan}_${hp.tenHocPhan}_${hp.soTinChi}`;

		    if (!monHocMap.has(key)) {
		        monHocMap.set(key, {
		            hocPhan: hp,
		            chuongTrinhInfos: []
		        });
		    }

		    monHocMap.get(key).chuongTrinhInfos.push({
		        khoa: chuongTrinh.khoa,
		        chuyenNganh: convertChuyenNganh(chuongTrinh.chuyenNganh),
		        loaiHocPhan: moTaLoai
		    });
		}

		// G·∫Øn s·ª± ki·ªán click cho n√∫t search
		$('#btnSearchMonHoc').click(function(e) {
		    e.preventDefault();
		    searchMonHoc();
		});
		// G·∫Øn s·ª± ki·ªán enter cho input search
		$('#searchMonHocInput').keypress(function(e) {
		    if (e.which === 13) {
		        e.preventDefault();
		        searchMonHoc();
		    }
		});
		document.getElementById('searchInput').addEventListener('keydown', function(event) {
		        if (event.key === 'Enter') {
		            event.preventDefault(); // NgƒÉn form submit n·∫øu c√≥
		            timKiemHocPhan(this.value);
		        }
		    });
		
		
    </script>
	<!-- Logout Modal-->
	<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	    <div class="modal-dialog" role="document">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="exampleModalLabel">ƒêƒÉng xu·∫•t?</h5>
	                <button class="close" type="button" data-dismiss="modal" aria-label="ƒê√≥ng">
	                    <span aria-hidden="true">√ó</span>
	                </button>
	            </div>
	            <div class="modal-body">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t kh·ªèi phi√™n l√†m vi·ªác?</div>
	            <div class="modal-footer">
	                <button class="btn btn-secondary" type="button" data-dismiss="modal">H·ªßy</button>
	                <a class="btn btn-primary" href="login.html" onclick="logout()">ƒêƒÉng xu·∫•t</a>
	            </div>
	        </div>
	    </div>
	</div>

</body>
</html>